<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>åŠæ‰“é¢è¯•å®˜03:Mysqlå¦‚ä½•å­˜å‚¨ç›®å½•æ ‘ - Troyçš„ç½‘ç»œåšå®¢</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Troy" /><meta name="description" content="do book" /><meta name="keywords" content="daily-interview-question, Github, c&#43;&#43;, Leetcode é¢˜è§£, åç«¯é¢è¯•" />






<meta name="generator" content="Hugo 0.83.1 with theme even" />


<link rel="canonical" href="https://wangcy6.github.io/post/interview/interviewSystemDesgin/2025/day17-system-desgin-03-dir-tree/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="åŠæ‰“é¢è¯•å®˜03:Mysqlå¦‚ä½•å­˜å‚¨ç›®å½•æ ‘" />
<meta property="og:description" content="do book" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://wangcy6.github.io/post/interview/interviewSystemDesgin/2025/day17-system-desgin-03-dir-tree/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2024-08-07T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2024-08-07T00:00:00&#43;00:00" />

<meta itemprop="name" content="åŠæ‰“é¢è¯•å®˜03:Mysqlå¦‚ä½•å­˜å‚¨ç›®å½•æ ‘">
<meta itemprop="description" content="do book"><meta itemprop="datePublished" content="2024-08-07T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2024-08-07T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="3788">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="åŠæ‰“é¢è¯•å®˜03:Mysqlå¦‚ä½•å­˜å‚¨ç›®å½•æ ‘"/>
<meta name="twitter:description" content="do book"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->
<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">
</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Even</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">é¦–é¡µ</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">å½’æ¡£</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">åˆ†ç±»</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">æ ‡ç­¾</li>
      </a><a href="https://github.com/wangcy6/weekly/tree/master/book">
        <li class="mobile-menu-item">é˜…è¯»æ¸…å•</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">å…³äºæˆ‘</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Even</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">é¦–é¡µ</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">å½’æ¡£</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">åˆ†ç±»</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">æ ‡ç­¾</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://github.com/wangcy6/weekly/tree/master/book">é˜…è¯»æ¸…å•</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">å…³äºæˆ‘</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">åŠæ‰“é¢è¯•å®˜03:Mysqlå¦‚ä½•å­˜å‚¨ç›®å½•æ ‘</h1>

      <div class="post-meta">
        <span class="post-time"> 2024-08-07 00:00 </span>
        <div class="post-category">
            <a href="/categories/do-book/"> do book </a>
            </div>
          <span class="more-meta"> çº¦ 3788 å­— </span>
          <span class="more-meta"> é¢„è®¡é˜…è¯» 8 åˆ†é’Ÿ </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> æ¬¡é˜…è¯» </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#11-é¢˜ç›®æè¿°">1.1 é¢˜ç›®æè¿°</a></li>
    <li><a href="#12-é‡‡ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„è¡¨ç¤ºæ•°æ®åº“è®¾è®¡">1.2 é‡‡ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„è¡¨ç¤ºï¼Ÿï¼ˆæ•°æ®åº“è®¾è®¡ï¼‰</a>
      <ul>
        <li><a href="#ä»€ä¹ˆæ˜¯é‚»æ¥åˆ—è¡¨">ä»€ä¹ˆæ˜¯é‚»æ¥åˆ—è¡¨</a></li>
        <li><a href="#é‚»æ¥åˆ—è¡¨ä¼˜ç‚¹">é‚»æ¥åˆ—è¡¨ä¼˜ç‚¹</a></li>
        <li><a href="#æ•°æ®åº“è®¾è®¡ä¸‰å¤§èŒƒå¼">æ•°æ®åº“è®¾è®¡ä¸‰å¤§èŒƒå¼</a></li>
        <li><a href="#é‚»æ¥åˆ—è¡¨ç¼ºç‚¹">é‚»æ¥åˆ—è¡¨ç¼ºç‚¹</a></li>
        <li><a href="#13-è¿˜æœ‰å…¶ä»–å­˜å‚¨æ–¹å¼å—">1.3 è¿˜æœ‰å…¶ä»–å­˜å‚¨æ–¹å¼å—ï¼Ÿ</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#21-æ–¹å¼1-ç›´æ¥ç”¨æŒ‡é’ˆè¡¨ç¤º">2.1 æ–¹å¼1 ç›´æ¥ç”¨æŒ‡é’ˆè¡¨ç¤º</a></li>
        <li><a href="#22-ä»demoåˆ°äº§å“åŒ–cephfs">2.2 ä»demoåˆ°äº§å“åŒ–(CephFS)</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </a></li>
    <li><a href="#å‚è€ƒæ•°æ®">å‚è€ƒæ•°æ®</a>
      <ul>
        <li><a href="#æœ€åŠ¨äººçš„ä½œå“ä¸ºè‡ªå·±è€Œå†™åˆšåˆšå¥½æ‰“åŠ¨åˆ«äºº">æœ€åŠ¨äººçš„ä½œå“ï¼Œä¸ºè‡ªå·±è€Œå†™ï¼Œåˆšåˆšå¥½æ‰“åŠ¨åˆ«äºº</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
  <div class="post-outdated">
    <div class="hint">
      <p>ã€æ³¨æ„ã€‘æœ€åæ›´æ–°äº <span class="timeago" datetime="2024-08-07T00:00:00" title="August 7, 2024">August 7, 2024</span>ï¼Œæ–‡ä¸­å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼Œè¯·è°¨æ…ä½¿ç”¨ã€‚</p>
    </div>
  </div>
    <div class="post-content">
      <h1 id="ä¸€é’é“œå‰ç«¯å¼€å‘å±•ç¤ºä¸€ä¸ªå¤šçº§èœå•ç›®å½•">ä¸€ã€é’é“œï¼šå‰ç«¯å¼€å‘å±•ç¤ºä¸€ä¸ªå¤šçº§èœå•(ç›®å½•)</h1>
<h2 id="11-é¢˜ç›®æè¿°">1.1 é¢˜ç›®æè¿°</h2>
<p>æ ‘çŠ¶ç»“æ„æˆ–å±‚æ¬¡ç»“æ„çš„æ•°æ®åœ¨ä¼ä¸šåº”ç”¨é‡Œéå¸¸å¸¸è§ï¼Œ
ä¾‹å¦‚å…¬å¸çš„ç»„ç»‡æ¶æ„ã€æ–‡æ¡£åº“çš„ç›®å½•ç»“æ„ã€
ä»“åº“çš„åº“ä½ç»„ç»‡ä»¥åŠç‰©ä»¶çš„åˆ†ç±»ç­‰ç­‰</p>
<p>å¦‚å›¾ï¼š
<img src="https://pic4.zhimg.com/v2-84fb2a74ea2cbb16d9bb243810221ce7_1440w.jpg" alt=""></p>
<p>è¯·è®¾è®¡ä¸€ä¸ªè¡¨ç»“æ„ï¼Œå­˜å‚¨å¤šçº§èœå•ï¼ˆç›®å½•ï¼‰</p>
<h2 id="12-é‡‡ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„è¡¨ç¤ºæ•°æ®åº“è®¾è®¡">1.2 é‡‡ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„è¡¨ç¤ºï¼Ÿï¼ˆæ•°æ®åº“è®¾è®¡ï¼‰</h2>
<h3 id="ä»€ä¹ˆæ˜¯é‚»æ¥åˆ—è¡¨">ä»€ä¹ˆæ˜¯é‚»æ¥åˆ—è¡¨</h3>
<p>é‚»æ¥åˆ—è¡¨æ¨¡å‹çš„ç‰¹ç‚¹æ˜¯ç®€å•ã€‚
è¡¨ä¸­çš„æ¯æ¡è®°å½•éƒ½åŒ…å«å¯¹å…¶çˆ¶çº§çš„å¼•ç”¨ï¼Œå½¢æˆçˆ¶å­å…³ç³»ã€‚
è¿™é€šå¸¸æ˜¯é€šè¿‡ä½¿ç”¨å­˜å‚¨çˆ¶èŠ‚ç‚¹æ ‡è¯†ç¬¦çš„åˆ—æ¥å®ç°çš„ã€‚
æ²¡æœ‰çˆ¶èŠ‚ç‚¹çš„æ ¹èŠ‚ç‚¹é€šå¸¸ç”±çˆ¶åˆ—ä¸­çš„Â <code>NULL</code>Â å€¼è¡¨ç¤ºã€‚</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>
<p>ç®€å•ç›´è§‚ï¼Œå®¹æ˜“è®¾è®¡</p>
</li>
<li>
<p>æ’å…¥ã€æ›´æ–°ã€åˆ é™¤å•èŠ‚ç‚¹æ–¹ä¾¿</p>
</li>
</ul>
<p>é—®é¢˜ï¼ˆåœ¨ SQL æŸ¥è¯¢ä¸­æš´éœ²ï¼‰ï¼š</p>
<ul>
<li>
<p><strong>éš¾ä»¥ä¸€æ¬¡æ€§æŸ¥è¯¢å‡ºæ•´æ£µæ ‘</strong></p>
</li>
<li>
<p>æŸ¥è¯¢æ‰€æœ‰ç¥–å…ˆæˆ–æ‰€æœ‰å­å­™æ—¶éœ€è¦é€’å½’ï¼Œè€Œæ ‡å‡† SQL ä¸æ”¯æŒé€’å½’ï¼ˆæ—§ç‰ˆæœ¬ï¼‰</p>
</li>
<li>
<p>éœ€è¦æ•°æ®åº“æ”¯æŒ <code>WITH RECURSIVE</code> æˆ–è€…é€šè¿‡ç¨‹åºç«¯æ„é€ </p>
</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<table>
<thead>
<tr>
<th>category_id</th>
<th>parent_id</th>
<th>category_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>NULL</td>
<td>Electronics</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>Computers</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>Laptops</td>
</tr>
<tr>
<td>4</td>
<td>2</td>
<td>Desktops</td>
</tr>
<tr>
<td>5</td>
<td>1</td>
<td>Televisions</td>
</tr>
<tr>
<td>6</td>
<td>3</td>
<td>Gaming Laptops</td>
</tr>
<tr>
<td>7</td>
<td>3</td>
<td>Business Laptop</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="o">//</span><span class="err">è¡¨ç»“æ„</span><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="p">(</span><span class="w">
</span><span class="w">  </span><span class="n">category_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span><span class="w">  </span><span class="n">parent_id</span><span class="w">   </span><span class="nb">INT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span><span class="w">  </span><span class="n">category_name</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span><span class="w">  </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">parent_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">categories</span><span class="p">(</span><span class="n">category_id</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_categories_parent</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">categories</span><span class="p">(</span><span class="n">parent_id</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="o">//</span><span class="err">æ’å…¥è®°å½•</span><span class="w">
</span><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="p">(</span><span class="n">category_id</span><span class="p">,</span><span class="w"> </span><span class="n">category_name</span><span class="p">,</span><span class="w"> </span><span class="n">parent_id</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Electronics&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">),</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Computers&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Laptops&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Desktops&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Smartphones&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h3 id="é‚»æ¥åˆ—è¡¨ä¼˜ç‚¹">é‚»æ¥åˆ—è¡¨ä¼˜ç‚¹</h3>
<h4 id="-ä¸ºä»€ä¹ˆä½¿ç”¨é‚»æ¥è¡¨æ¨¡å‹å­˜å‚¨å¤šçº§ç›®å½•">ğŸ“Œ ä¸ºä»€ä¹ˆä½¿ç”¨é‚»æ¥è¡¨æ¨¡å‹å­˜å‚¨å¤šçº§ç›®å½•ï¼Ÿ</h4>
<ol>
<li>ç®€å•ç›´è§‚ï¼Œå¼€å‘ä¸ç»´æŠ¤å‹å¥½</li>
<li>æ’å…¥ã€æ›´æ–°ã€åˆ é™¤æ“ä½œé«˜æ•ˆ</li>
<li>æŸ¥è¯¢å¸¸è§è®¿é—®è·¯å¾„é«˜æ•ˆ</li>
</ol>
<blockquote>
<p>ä¸ªäººæ„Ÿå—ï¼šâœ”ï¸ ä¸ºä»€ä¹ˆä¸€èˆ¬ç”¨ <code>parent_id</code> è€Œé <code>child_id</code>ï¼Ÿ</p>
</blockquote>
<ul>
<li>å¤šçº§ç›®å½•æˆ–åˆ†ç±»ç»“æ„ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹é€šå¸¸<strong>åªæœ‰ä¸€ä¸ªçˆ¶èŠ‚ç‚¹</strong>ï¼Œä½†å¯ä»¥æœ‰å¤šä¸ªå­èŠ‚ç‚¹</li>
<li>ç”¨ <code>parent_id</code> çš„é‚»æ¥è¡¨æ¨¡å‹ç¬¦åˆå…³ç³»å‹æ•°æ®åº“èŒƒå¼ã€‚è‹¥ç”¨ <code>child_id</code>ï¼Œéœ€å®šä¹‰å¤šä¸ªå­å­—æ®µï¼Œ<strong>å®¹æ˜“è¿åç¬¬ä¸€èŒƒå¼ï¼ˆ1NF</strong>ï¼‰ï¼Œéš¾ä»¥æ‰©å±•ï¼Œå­—æ®µå†—ä½™ä¸¥é‡</li>
</ul>
<h3 id="æ•°æ®åº“è®¾è®¡ä¸‰å¤§èŒƒå¼">æ•°æ®åº“è®¾è®¡ä¸‰å¤§èŒƒå¼</h3>
<p>ï¼ˆ1ï¼‰ç®€å•å½’çº³ï¼š
ã€€ã€€ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰ï¼šå­—æ®µä¸å¯åˆ†ï¼›<br>
ã€€ã€€ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ï¼šæœ‰ä¸»é”®ï¼Œéä¸»é”®å­—æ®µä¾èµ–ä¸»é”®ï¼›<br>
ã€€ã€€ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ï¼šéä¸»é”®å­—æ®µä¸èƒ½ç›¸äº’ä¾èµ–ã€‚
ï¼ˆ2ï¼‰è§£é‡Šï¼š
ã€€ã€€1NFï¼šåŸå­æ€§ã€‚ å­—æ®µä¸å¯å†åˆ†,å¦åˆ™å°±ä¸æ˜¯å…³ç³»æ•°æ®åº“;ï¼›<br>
ã€€ã€€2NFï¼šå”¯ä¸€æ€§ ã€‚ä¸€ä¸ªè¡¨åªè¯´æ˜ä¸€ä¸ªäº‹ç‰©ï¼›<br>
ã€€ã€€3NFï¼šæ¯åˆ—éƒ½ä¸ä¸»é”®æœ‰ç›´æ¥å…³ç³»ï¼Œä¸å­˜åœ¨ä¼ é€’ä¾èµ–ã€‚</p>
<p>é“¶è¡Œçš„é¢è¯•å®˜é—®äº†ä¸ªç®€å•çš„é—®é¢˜ï¼Œæ»¡è¶³ç¬¬äºŒèŒƒå¼ï¼Œä½†æ˜¯ä¸æ»¡è¶³ç¬¬ä¸‰èŒƒå¼çš„ä¾‹å­</p>
<p>ç¬¬ä¸‰èŒƒå¼å®šä¹‰ï¼šæ‰€æœ‰çš„éä¸»å±æ€§ï¼ˆéä¸»é”®ï¼‰éƒ½ç›´æ¥ç”±å…¶å®ƒè¡¨çš„ä¸»å±æ€§ï¼ˆä¸»é”®ï¼‰æ¨å¯¼ç”Ÿæˆï¼Œè€Œä¸éœ€è¦<strong>ä¼ é€’ä¾èµ–</strong>ã€‚Â Â </p>
<p><strong>é‡ç‚¹ï¼š</strong>
<strong>1ï¼‰æ»¡è¶³ç¬¬äºŒèŒƒå¼ã€‚</strong>
<strong>2ï¼‰ä¸èƒ½ä¼ é€’ä¾èµ–ï¼Œéä¸»å±æ€§ä¸èƒ½éƒ¨åˆ†æˆ–è€…ä¼ é€’ä¾èµ–äºç ã€‚</strong></p>
<blockquote>
<p>è¡¨: å­¦å·, å§“å, å¹´é¾„, å­¦é™¢åç§°, å­¦é™¢ç”µè¯</p>
</blockquote>
<p>å› ä¸ºå­˜åœ¨ä¾èµ–ä¼ é€’: (å­¦å·) â†’ (å­¦ç”Ÿ)â†’(æ‰€åœ¨å­¦é™¢) â†’ (å­¦é™¢ç”µè¯) ã€‚</p>
<p>æ­£ç¡®åšæ³•ï¼š</p>
<p>å­¦ç”Ÿï¼š(å­¦å·, å§“å, å¹´é¾„, æ‰€åœ¨å­¦é™¢)ï¼›</p>
<p>å­¦é™¢ï¼š(å­¦é™¢, ç”µè¯)ã€‚</p>
<h3 id="é‚»æ¥åˆ—è¡¨ç¼ºç‚¹">é‚»æ¥åˆ—è¡¨ç¼ºç‚¹</h3>
<h4 id="1-æ·±åº¦éå†æ•ˆç‡è¾ƒå·®">1. <strong>æ·±åº¦éå†æ•ˆç‡è¾ƒå·®</strong></h4>
<p>è¦æŸ¥è¯¢æŸä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰åä»£ï¼ˆdeep descendantsï¼‰æˆ–å®Œæ•´è·¯å¾„ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨é€’å½’æŸ¥è¯¢ï¼ˆå¦‚ CTEï¼‰æˆ–å¤šæ¬¡è‡ªè¿æ¥ã€‚å¯¹äºæ ‘æ·±åº¦è¾ƒå¤§æ—¶ï¼ŒæŸ¥è¯¢éå¸¸å¤æ‚ä¸”æ€§èƒ½ä½ä¸‹ã€‚</p>
<blockquote>
<p>â€œFinding all descendants of a node requires recursive queries or multiple joinsâ€</p>
</blockquote>
<h4 id="2-è·¯å¾„æŸ¥è¯¢ä¸ä¾¿">2. <strong>è·¯å¾„æŸ¥è¯¢ä¸ä¾¿</strong></h4>
<p>æƒ³è¦æŸ¥è¯¢æŸä¸ªèŠ‚ç‚¹ä»æ ¹èŠ‚ç‚¹åˆ°å®ƒçš„å®Œæ•´è·¯å¾„ï¼Œéœ€è¦å¤šå±‚è¿æ¥å¹¶æå‰çŸ¥é“æ ‘æ·±åº¦ï¼Œå¦åˆ™æ— æ³•æ„é€ å›ºå®šæ•°é‡çš„è‡ªå…³è” JOINã€‚</p>
<blockquote>
<p>â€œBefore being able to see the full path â€¦ we have to know the level at which it resides.â€</p>
</blockquote>
<h3 id="13-è¿˜æœ‰å…¶ä»–å­˜å‚¨æ–¹å¼å—">1.3 è¿˜æœ‰å…¶ä»–å­˜å‚¨æ–¹å¼å—ï¼Ÿ</h3>
<p>è¯·å‚è€ƒï¼š</p>
<ul>
<li>SQLåæ¨¡å¼ ç¬¬ä¸‰ç« èŠ‚  å• çº¯ çš„ æ ‘</li>
<li>SQL Antipatterns.  Naive Trees
<img src="https://s2.loli.net/2025/07/28/UjGVKqOPd2AZ5hX.png" alt="SQLåæ¨¡å¼"></li>
</ul>
<h1 id="äºŒç™½é“¶åç«¯å¼€å‘-è¯·è®¾è®¡è¡¨ç¤ºå¤šçº§ç›®å½•çš„ç±»å’Œç›¸å…³æ¥å£">äºŒã€ç™½é“¶ï¼šåç«¯å¼€å‘ è¯·è®¾è®¡è¡¨ç¤ºå¤šçº§ç›®å½•çš„ç±»å’Œç›¸å…³æ¥å£</h1>
<blockquote>
<p>[!NOTE] æ•°æ®åº“çš„è¡¨è¦è¯»å–å†…å­˜ä¸­å»å§
å¦‚ä½•åœ¨å†…å­˜ä¸­è¡¨ç¤º</p>
</blockquote>
<h3 id="21-æ–¹å¼1-ç›´æ¥ç”¨æŒ‡é’ˆè¡¨ç¤º">2.1 æ–¹å¼1 ç›´æ¥ç”¨æŒ‡é’ˆè¡¨ç¤º</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">class</span> <span class="nc">CategoryNode</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">category_id</span><span class="p">;</span>            <span class="c1">// èŠ‚ç‚¹IDï¼ˆä¸»é”®ï¼‰
</span><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">category_name</span><span class="p">;</span> <span class="c1">// åˆ†ç±»åç§°
</span><span class="c1"></span>    <span class="n">CategoryNode</span><span class="o">*</span> <span class="n">parent</span><span class="p">;</span>      <span class="c1">// æŒ‡å‘çˆ¶èŠ‚ç‚¹çš„æŒ‡é’ˆï¼ˆå¼±å¼•ç”¨ï¼Œé¿å…å¾ªç¯å¼ºå¼•ç”¨ï¼‰
</span><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">CategoryNode</span><span class="o">&gt;&gt;</span> <span class="n">children</span><span class="p">;</span> <span class="c1">// å­èŠ‚ç‚¹åˆ—è¡¨
</span><span class="c1"></span>
    <span class="c1">// æ„é€ å‡½æ•°
</span><span class="c1"></span>    <span class="n">CategoryNode</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span> <span class="n">CategoryNode</span><span class="o">*</span> <span class="n">parent_ptr</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">category_id</span><span class="p">(</span><span class="n">id</span><span class="p">),</span> <span class="n">category_name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">parent</span><span class="p">(</span><span class="n">parent_ptr</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">CategoryTree</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">CategoryNode</span><span class="o">&gt;</span> <span class="n">root</span><span class="p">;</span> <span class="c1">// æ ¹èŠ‚ç‚¹
</span><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">CategoryNode</span><span class="o">*&gt;</span> <span class="n">node_map</span><span class="p">;</span> <span class="c1">// IDåˆ°èŠ‚ç‚¹çš„æ˜ å°„ï¼ˆåŠ é€ŸæŸ¥æ‰¾ï¼‰
</span><span class="c1"></span>
<span class="k">public</span><span class="o">:</span>
    <span class="c1">// æ·»åŠ èŠ‚ç‚¹ï¼ˆè‡ªåŠ¨å…³è”çˆ¶å­å…³ç³»ï¼‰
</span><span class="c1"></span>    <span class="kt">void</span> <span class="n">add_node</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">parent_id</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">CategoryNode</span><span class="o">*</span> <span class="n">parent_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="n">parent_id</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="k">nullptr</span> <span class="o">:</span> <span class="n">node_map</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">parent_id</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">new_node</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">CategoryNode</span><span class="o">&gt;</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parent_ptr</span><span class="p">);</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">parent_ptr</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">parent_ptr</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">new_node</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// æ ¹èŠ‚ç‚¹
</span><span class="c1"></span>            <span class="n">root</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">new_node</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">node_map</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_map</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">?</span> <span class="n">root</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">:</span> <span class="n">parent_ptr</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">get</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// è·å–ä»æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CategoryNode</span><span class="o">*&gt;</span> <span class="n">get_path</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CategoryNode</span><span class="o">*&gt;</span> <span class="n">path</span><span class="p">;</span>
    <span class="n">CategoryNode</span><span class="o">*</span> <span class="n">current</span> <span class="o">=</span> <span class="n">get_node</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">current</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">path</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">current</span><span class="p">);</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">reverse</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">path</span><span class="p">.</span><span class="n">end</span><span class="p">());</span> <span class="c1">// ä»æ ¹åˆ°å½“å‰
</span><span class="c1"></span>    <span class="k">return</span> <span class="n">path</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// æŸ¥æ‰¾æ‰€æœ‰åä»£èŠ‚ç‚¹ï¼ˆå¹¿åº¦ä¼˜å…ˆï¼‰
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CategoryNode</span><span class="o">*&gt;</span> <span class="n">get_descendants</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CategoryNode</span><span class="o">*&gt;</span> <span class="n">result</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="o">&lt;</span><span class="n">CategoryNode</span><span class="o">*&gt;</span> <span class="n">queue</span><span class="p">;</span>
    <span class="n">queue</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">get_node</span><span class="p">(</span><span class="n">id</span><span class="p">));</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">queue</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">auto</span> <span class="n">current</span> <span class="o">=</span> <span class="n">queue</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
        <span class="n">queue</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">child</span> <span class="p">:</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">result</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
            <span class="n">queue</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="22-ä»demoåˆ°äº§å“åŒ–cephfs">2.2 ä»demoåˆ°äº§å“åŒ–(CephFS)</h3>
<p>ğŸ§© CephFS çš„ç›®å½•æ ‘ç»“æ„
ğŸ”¹ Metadata Serverï¼ˆMDSï¼‰</p>
<ul>
<li>
<p>MDS è´Ÿè´£ç®¡ç†æ–‡ä»¶å’Œç›®å½•å…ƒæ•°æ®</p>
</li>
<li>
<p>æ¯ä¸ªç›®å½•/æ–‡ä»¶æ˜¯ä¸€ä¸ª inodeï¼Œä½¿ç”¨ç±»ä¼¼æ–‡ä»¶ç³»ç»Ÿçš„æ ‘å½¢ç»„ç»‡</p>
</li>
<li>
<p>ç›®å½•ä¹‹é—´é€šè¿‡ <code>parent</code> å’Œ <code>child</code> å…³ç³»å½¢æˆå±‚çº§</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="nl">https</span><span class="p">:</span><span class="c1">//github.com/ceph/ceph/blob/main/src/mds/CInode.h
</span><span class="c1">//MDSå†…éƒ¨æ•°æ®ç»“æ„
</span><span class="c1"></span><span class="k">class</span> <span class="nc">CInode</span> <span class="p">{</span>
  <span class="n">inodeno_t</span> <span class="n">ino</span><span class="p">;</span>
  <span class="n">snapid_t</span> <span class="n">snapid</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">CDentry</span><span class="o">*&gt;</span> <span class="n">dentries</span><span class="p">;</span> <span class="c1">// children
</span><span class="c1"></span>  <span class="n">CInode</span><span class="o">*</span> <span class="n">parent</span><span class="p">;</span>         <span class="c1">// pointer to parent directory
</span><span class="c1"></span><span class="p">};</span>
<span class="c1">//OpenFileTableâ€‹ ç»“æ„åŠ é€Ÿæ¢å¤ï¼šè®°å½•æ‰“å¼€æ–‡ä»¶çš„è·¯å¾„ä¿¡æ¯ï¼Œé¿å…å…¨é‡åŠ è½½
</span><span class="c1"></span><span class="n">CInode</span> <span class="p">(</span><span class="err">æ ¹ç›®å½•</span><span class="p">)</span> 
<span class="err">â”‚</span>
<span class="err">â””â”€â”€</span> <span class="n">CDir</span> <span class="p">(</span><span class="err">æ ¹ç›®å½•å†…å®¹</span><span class="p">)</span>
    <span class="err">â”œâ”€â”€</span> <span class="n">CDentry</span> <span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">)</span> <span class="err">â”€â”€</span> <span class="n">CInode</span> <span class="p">(</span><span class="err">ç›®å½•</span><span class="s">&#34;a&#34;</span><span class="p">)</span>
    <span class="err">â”‚</span>               <span class="err">â”‚</span>
    <span class="err">â”‚</span>               <span class="err">â””â”€â”€</span> <span class="n">CDir</span> <span class="p">(</span><span class="err">ç›®å½•</span><span class="s">&#34;a&#34;</span><span class="err">å†…å®¹</span><span class="p">)</span>
    <span class="err">â”‚</span>                   <span class="err">â””â”€â”€</span> <span class="n">CDentry</span> <span class="p">(</span><span class="s">&#34;b.txt&#34;</span><span class="p">)</span> <span class="err">â”€â”€</span> <span class="n">CInode</span> <span class="p">(</span><span class="err">æ–‡ä»¶</span><span class="s">&#34;b.txt&#34;</span><span class="p">)</span>
    <span class="err">â”‚</span>
    <span class="err">â””â”€â”€</span> <span class="n">CDentry</span> <span class="p">(</span><span class="s">&#34;c&#34;</span><span class="p">)</span> <span class="err">â”€â”€</span> <span class="n">CInode</span> <span class="p">(</span><span class="err">æ–‡ä»¶</span><span class="s">&#34;c&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Ceph æ–‡ä»¶ç³»ç»Ÿç”± MDSï¼ˆMetadata Serverï¼‰ç®¡ç†ç›®å½•æ ‘ç»“æ„ï¼Œå…¶å†…å­˜æ¨¡å‹æ ¸å¿ƒç”±ä¸‰ç§ç»“æ„ç»„æˆï¼š</p>
<ul>
<li><strong>CInode</strong>ï¼šè¡¨ç¤ºæ¯ä¸ªæ–‡ä»¶æˆ–ç›®å½•çš„</li>
<li><strong>CDentry</strong>ï¼šå…³è” inode ä¸å…¶åç§°ï¼ˆç›®å½•é¡¹ï¼‰ï¼Œæ”¯æŒåŒä¸€ä¸ª inode å¤šä¸ªè·¯å¾„ï¼ˆç¡¬é“¾æ¥ï¼‰ï¼›</li>
<li><strong>CDir</strong>ï¼šä»…ç”¨äºç›®å½• inodeï¼Œå°†è¯¥ç›®å½•ä¸‹æ‰€æœ‰ CDentry ç»„ç»‡èµ·æ¥ã€‚å½“ç›®å½•è¢«ç¢ç‰‡åŒ–æ—¶ï¼Œä¸€ä¸ª CInode å¯å¯¹åº”å¤šä¸ª CDir
<img src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/e13svNCGUiaoVfibWwXkaXLwNYvyMt6xkmdrBDkbZamibyfzEGF0qWOHaibPJzRPm9u4gvaCZWibWDXWqwW333y876Q/640?wx_fmt=jpeg&amp;randomid=herxbyvf&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></li>
</ul>
<h4 id="-ç»“æ„ç‰¹ç‚¹">ğŸ“Œ ç»“æ„ç‰¹ç‚¹</h4>
<ul>
<li>ä½¿ç”¨ C++ ç±»ç»“æ„ï¼šçˆ¶æŒ‡é’ˆ + å­é›†åˆ</li>
<li>æ›´æ–°ç›®å½•ã€æ’å…¥æ–‡ä»¶ã€é€’å½’éå†éƒ½åœ¨æ ‘ç»“æ„ä¸Šè¿›è¡Œ</li>
<li>
<ul>
<li><strong>åŠ¨æ€æ‰©å±•â€‹</strong>â€‹ï¼šç›®å½•è¿‡å¤§æ—¶ï¼Œ<code>CDir</code>Â è‡ªåŠ¨åˆ†ç‰‡ï¼ˆå¦‚ 10,000 æ–‡ä»¶/ç›®å½•ï¼‰ï¼Œæ–°åˆ†ç‰‡ç”Ÿæˆç‹¬ç«‹Â <code>CDir</code></li>
</ul>
</li>
<li>â€‹<strong>â€‹æŒä¹…åŒ–ä¸æ¢å¤â€‹</strong>â€‹ï¼š
<ul>
<li>å…ƒæ•°æ®é€šè¿‡ Journal å†™å…¥ RADOS æŒä¹…åŒ–ã€‚</li>
<li>MDS é‡å¯æ—¶ï¼Œä» RADOS åŠ è½½å…ƒæ•°æ®é‡å»ºå†…å­˜æ ‘ã€‚</li>
<li>â€‹<strong>â€‹OpenFileTableâ€‹</strong>â€‹ ç»“æ„åŠ é€Ÿæ¢å¤ï¼šè®°å½•æ‰“å¼€æ–‡ä»¶çš„è·¯å¾„ä¿¡æ¯ï¼Œé¿å…å…¨é‡åŠ è½½</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>â€‹<strong>â€‹æ•°æ®ç»“æ„â€‹</strong>â€‹</th>
<th>â€‹<strong>â€‹è§’è‰²â€‹</strong>â€‹</th>
<th>â€‹<strong>â€‹å…³é”®ä½œç”¨â€‹</strong>â€‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CInode</code></td>
<td>å…ƒæ•°æ®å®ä½“</td>
<td>å­˜å‚¨æ–‡ä»¶/ç›®å½•å±æ€§ï¼ŒæŒ‡å‘æ•°æ®å—ä½ç½®ã€‚</td>
</tr>
<tr>
<td><code>CDentry</code></td>
<td>åç§°åˆ°å®ä½“çš„æ˜ å°„</td>
<td>é“¾æ¥æ–‡ä»¶åä¸Â <code>CInode</code>ï¼Œæ„å»ºè·¯å¾„å±‚çº§ã€‚</td>
</tr>
<tr>
<td><code>CDir</code></td>
<td>ç›®å½•å†…å®¹å®¹å™¨</td>
<td>ç®¡ç†å­é¡¹ï¼Œæ”¯æŒåˆ†ç‰‡ä»¥ä¼˜åŒ–å¤§è§„æ¨¡ç›®å½•æ€§èƒ½ã€‚</td>
</tr>
</tbody>
</table>
<h1 id="ä¸‰å¦‚ä½•ä½“ç°å·¦å³å­æ ‘ä¸ä½“ç°">ä¸‰ã€å¦‚ä½•ä½“ç°å·¦å³å­æ ‘ï¼ˆä¸ä½“ç°ï¼‰</h1>
<p>æ²¡æœ‰å·¦å³å­æ ‘çš„å­—æ®µï¼Œå› ä¸ºç›®å½•ç»“æ„æ˜¯å¤šå‰æ ‘</p>
<h1 id="å››leetcode--588é¢˜">å››ã€Leetcode  588é¢˜</h1>
<p>è®¾è®¡ä¸€ä¸ªå†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼Œæ¨¡æ‹Ÿä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<p>å®ç°æ–‡ä»¶ç³»ç»Ÿç±»:</p>
<ul>
<li><code>FileSystem()</code>Â åˆå§‹åŒ–ç³»ç»Ÿå¯¹è±¡</li>
<li><code>List&lt;String&gt; ls(String path)</code></li>
<li><code>void mkdir(String path)</code>Â æ ¹æ®ç»™å®šçš„è·¯å¾„åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ã€‚ç»™å®šçš„ç›®å½•è·¯å¾„ä¸å­˜åœ¨ã€‚å¦‚æœè·¯å¾„ä¸­çš„ä¸­é—´ç›®å½•ä¸å­˜åœ¨ï¼Œæ‚¨ä¹Ÿåº”è¯¥åˆ›å»ºå®ƒä»¬ã€‚</li>
<li><code>void addContentToFile(String filePath, String content)</code></li>
<li><code>String readContentFromFile(String filePath)</code>Â è¿”å›Â <code>filePath</code>ä¸‹çš„æ–‡ä»¶å†…å®¹ã€‚
<img src="https://camo.githubusercontent.com/ca580a65e5ba44458a4aa78aa8598a580a3236ce0a228a13a3bd00683316abb3/68747470733a2f2f666173746c792e6a7364656c6976722e6e65742f67682f646f6f63732f6c656574636f6465406d61696e2f736f6c7574696f6e2f303530302d303539392f303538382e44657369676e253230496e2d4d656d6f727925323046696c6525323053797374656d2f696d616765732f66696c6573797374656d2e706e67" alt=""></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">FileSystem fileSystem = new FileSystem();
fileSystem.ls(&#34;/&#34;);                         // è¿”å› []
fileSystem.mkdir(&#34;/a/b/c&#34;);
fileSystem.addContentToFile(&#34;/a/b/c/d&#34;, &#34;hello&#34;);
fileSystem.ls(&#34;/&#34;);                         // è¿”å› [&#34;a&#34;]
fileSystem.readContentFromFile(&#34;/a/b/c/d&#34;); // è¿”å› &#34;hello&#34;
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unordered_map&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;set&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sstream&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FileSystem</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="c1">// æ–‡ä»¶ç³»ç»ŸèŠ‚ç‚¹ç»“æ„
</span><span class="c1"></span>    <span class="k">struct</span> <span class="nc">FileNode</span> <span class="p">{</span>
        <span class="kt">bool</span> <span class="n">isFile</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>          <span class="c1">// æ˜¯å¦ä¸ºæ–‡ä»¶
</span><span class="c1"></span>        <span class="n">string</span> <span class="n">content</span><span class="p">;</span>                <span class="c1">// æ–‡ä»¶å†…å®¹
</span><span class="c1"></span>        <span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">FileNode</span><span class="o">*&gt;</span> <span class="n">children</span><span class="p">;</span> <span class="c1">// å­èŠ‚ç‚¹æ˜ å°„
</span><span class="c1"></span>    <span class="p">};</span>

    <span class="n">FileNode</span><span class="o">*</span> <span class="n">root</span><span class="p">;</span> <span class="c1">// æ ¹èŠ‚ç‚¹æŒ‡é’ˆ
</span><span class="c1"></span>
    <span class="c1">// åˆ†å‰²è·¯å¾„ä¸ºç»„æˆéƒ¨åˆ†
</span><span class="c1"></span>    <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">splitPath</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">parts</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">||</span> <span class="n">path</span> <span class="o">==</span> <span class="s">&#34;/&#34;</span><span class="p">)</span> <span class="k">return</span> <span class="n">parts</span><span class="p">;</span>
        
        <span class="n">istringstream</span> <span class="nf">iss</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
        <span class="n">string</span> <span class="n">part</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">getline</span><span class="p">(</span><span class="n">iss</span><span class="p">,</span> <span class="n">part</span><span class="p">,</span> <span class="sc">&#39;/&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">part</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="n">parts</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">part</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">//
</span><span class="c1"></span>        <span class="k">return</span> <span class="n">parts</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// æ ¹æ®è·¯å¾„æŸ¥æ‰¾èŠ‚ç‚¹
</span><span class="c1"></span>    <span class="n">FileNode</span><span class="o">*</span> <span class="nf">traverse</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">path</span> <span class="o">==</span> <span class="s">&#34;/&#34;</span><span class="p">)</span> <span class="k">return</span> <span class="n">root</span><span class="p">;</span>
        
        <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">splitPath</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
        <span class="n">FileNode</span><span class="o">*</span> <span class="n">current</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="nl">part</span> <span class="p">:</span> <span class="n">parts</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">current</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">part</span><span class="p">))</span> <span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">[</span><span class="n">part</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">current</span><span class="p">;</span>
    <span class="p">}</span>

<span class="k">public</span><span class="o">:</span>
    <span class="n">FileSystem</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">root</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileNode</span><span class="p">();</span> <span class="c1">// åˆå§‹åŒ–æ ¹èŠ‚ç‚¹
</span><span class="c1"></span>    <span class="p">}</span>

    <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">ls</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">FileNode</span><span class="o">*</span> <span class="n">node</span> <span class="o">=</span> <span class="n">traverse</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">node</span><span class="p">)</span> <span class="k">return</span> <span class="p">{};</span>
        
        <span class="c1">// æ–‡ä»¶è·¯å¾„ï¼šè¿”å›æ–‡ä»¶å
</span><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">isFile</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="n">find_last_of</span><span class="p">(</span><span class="sc">&#39;/&#39;</span><span class="p">);</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">path</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)};</span>
        <span class="p">}</span>
        
        <span class="c1">// ç›®å½•è·¯å¾„ï¼šè¿”å›æ’åºåçš„å­é¡¹åç§°
</span><span class="c1"></span>        <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">result</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">child</span> <span class="p">:</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">result</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="n">first</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">sort</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">result</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">mkdir</span><span class="p">(</span><span class="n">string</span> <span class="n">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">splitPath</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
        <span class="n">FileNode</span><span class="o">*</span> <span class="n">current</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>
        
        <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="nl">part</span> <span class="p">:</span> <span class="n">parts</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">current</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">part</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">current</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">[</span><span class="n">part</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileNode</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">[</span><span class="n">part</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">addContentToFile</span><span class="p">(</span><span class="n">string</span> <span class="n">filePath</span><span class="p">,</span> <span class="n">string</span> <span class="n">content</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">splitPath</span><span class="p">(</span><span class="n">filePath</span><span class="p">);</span>
        <span class="n">FileNode</span><span class="o">*</span> <span class="n">current</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>
        
        <span class="c1">// ç¡®ä¿ç›®å½•è·¯å¾„å­˜åœ¨
</span><span class="c1"></span>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">parts</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">current</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="p">{</span>
                <span class="n">current</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileNode</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
        <span class="p">}</span>
        
        <span class="c1">// å¤„ç†æ–‡ä»¶å
</span><span class="c1"></span>        <span class="n">string</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">parts</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">current</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">current</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">[</span><span class="n">fileName</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileNode</span><span class="p">();</span>
            <span class="n">current</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">[</span><span class="n">fileName</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">isFile</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">current</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">[</span><span class="n">fileName</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">content</span> <span class="o">+=</span> <span class="n">content</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">string</span> <span class="nf">readContentFromFile</span><span class="p">(</span><span class="n">string</span> <span class="n">filePath</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">FileNode</span><span class="o">*</span> <span class="n">node</span> <span class="o">=</span> <span class="n">traverse</span><span class="p">(</span><span class="n">filePath</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">node</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">isFile</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">content</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>æ ‡å‡†åº“ä¸­çš„Â <a href="https://zhida.zhihu.com/search?content_id=230676846&amp;content_type=Article&amp;match_order=1&amp;q=std%3A%3Agetline%28%29&amp;zhida_source=entity">std::getline()</a>Â æ˜¯ä¸€ä¸ªç”¨äºä»è¾“å…¥æµä¸­è¯»å–ä¸€è¡Œæ•°æ®çš„å‡½æ•°ã€‚å®ƒçš„å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">std</span><span class="o">::</span><span class="n">istream</span><span class="o">&amp;</span> <span class="n">getline</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">istream</span><span class="o">&amp;</span> <span class="n">is</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">str</span><span class="p">,</span> <span class="kt">char</span> <span class="n">delim</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ï¼Œis æ˜¯è¾“å…¥æµå¯¹è±¡ï¼Œstr æ˜¯å­˜å‚¨è¯»å–æ•°æ®çš„å­—ç¬¦ä¸²ï¼Œdelim æ˜¯æŒ‡å®šçš„è¡Œåˆ†éš”ç¬¦ï¼ˆé»˜è®¤ä¸ºæ¢è¡Œç¬¦ \nï¼‰ã€‚</p>
<h2 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </h2>
<ul>
<li>å¦‚ä½•åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­å­˜å‚¨æ ‘å½¢ç»“æ„</li>
<li>What is Third Normal Form (3NF)?</li>
</ul>
<h2 id="å‚è€ƒæ•°æ®">å‚è€ƒæ•°æ®</h2>
<ul>
<li>SQLåæ¨¡å¼ ç¬¬ä¸‰ç«   å• çº¯ çš„ æ ‘P29</li>
<li>SQL Antipatterns.  Naive Trees P34</li>
</ul>
<h3 id="æœ€åŠ¨äººçš„ä½œå“ä¸ºè‡ªå·±è€Œå†™åˆšåˆšå¥½æ‰“åŠ¨åˆ«äºº">æœ€åŠ¨äººçš„ä½œå“ï¼Œä¸ºè‡ªå·±è€Œå†™ï¼Œåˆšåˆšå¥½æ‰“åŠ¨åˆ«äºº</h3>
<p>æˆ‘åœ¨å¯»æ‰¾ä¸€ä½ç§¯æä¸Šè¿›çš„å°ä¼™ä¼´ï¼Œ
ä¸€èµ·å‚ä¸<strong>ç¥å¥‡æ—©èµ· 30 å¤©æ”¹å˜äººç”Ÿè®¡åˆ’</strong>ï¼Œå‘å±•ä¸ªäººäº‹æƒ…ï¼Œä¸å¦¨ è¯•è¯•
1ï¸âƒ£ åŠ å…¥æˆ‘çš„æŠ€æœ¯äº¤æµç¾¤Offer æ¥ç¢—é‡Œ (å›å¤â€œé¢ç»â€è·å–ï¼‰ï¼Œä¸€èµ·æŠ±å›¢å–æš–
<img src="https://s2.loli.net/2025/06/01/6qkOut3xrDHen8J.png" alt="">
2ï¸âƒ£å…³æ³¨å…¬ä¼—å·:åç«¯å¼€å‘æˆé•¿æŒ‡å—(å›å¤â€œé¢ç»â€è·å–ï¼‰è·å–è¿‡å»æˆ‘<strong>å…¨éƒ¨é¢è¯•å½•éŸ³</strong>å’Œå¤§å‚é¢è¯•å¤ç›˜æ”»ç•¥
<img src="https://s2.loli.net/2025/05/31/GRgOTiQHI456VWD.png" alt="">
3ï¸âƒ£ å›å¤ é¢ç» è·å–å…¨éƒ¨ç”µå­ä¹¦
å‚è€ƒï¼š<a href="https://mp.weixin.qq.com/s/y94rXLoJCllCXkhfL7d7Hg"># åˆ†å¸ƒå¼å¿…è¯»ç»å…¸ä¹¦ç±</a></p>
<h4 id="æŠ¬å¤´çœ‹å¤©èµ°æš—è·¯è€•ç˜¦ç”°è¿›çª„é—¨è§å¾®å…‰">æŠ¬å¤´çœ‹å¤©ï¼šèµ°æš—è·¯ã€è€•ç˜¦ç”°ã€è¿›çª„é—¨ã€è§å¾®å…‰ï¼Œ</h4>
<ul>
<li><!-- raw HTML omitted -->æˆ‘è¦é€šè¿‡æŠ€æœ¯æ‹¿åˆ°ç™¾ä¸‡å¹´è–ªP7èŒåŠ¡<!-- raw HTML omitted -->ï¼Œæ‰“é€šä»»ç£äºŒè„‰ã€‚</li>
<li>ä½†æ˜¯ä¸è¦ç»™è‡ªå·±è¿™æ ·å‡è®¾ï¼šåˆ«äººå®Œæˆå°±ç­‰ç€è‡ªå·±å®Œæˆäº†ï¼Œè¿™ä¸ªé€ƒé¿é—®é¢˜è¡¨ç°,è£å‘˜æ—¶å€™åˆ«äººä¸ä¼šè¿™ä¹ˆæƒ³ã€‚</li>
</ul>
<h5 id="ä½å¤´èµ°è·¯">ä½å¤´èµ°è·¯ï¼š</h5>
<ul>
<li>ä¸€æ¬¡ä¸“æ³¨åšå¥½ä¸€ä¸ªå°äº‹ã€‚</li>
<li>ä¸æ‰«ä¸€å±‹ ä½•ä»¥æ‰«å¤©ä¸‹ï¼Œè®©è‡ªå·±æ—©ç¡ï¼Œæ—©èµ·ï¼Œé”»ç‚¼èº«ä½“ï¼Œåˆ·ç‰™ä¿æŒä¸ªäººå«ç”Ÿï¼Œå¤šå–æ°´ ï¼Œè¡¨è¾¾æ¸…æ¥š ,æŠŠåŸºæœ¬äº‹æƒ…åšå¥½ã€‚</li>
</ul>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content">Troy</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">
        2024-08-07 00:00
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">è®¸å¯åè®®</span>
    <span class="item-content"><a target="_blank" rel="license noopener" href="https://github.com/nusr/blog/blob/master/LICENSE">MIT</a></span>
  </p>
</div>
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/interview/interviewSystemDesgin/2025/day19-system-desgin-1/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">ä¼ä¸šæ¡ˆä¾‹04:AIæ—¶ä»£åˆ†å¸ƒå¼å­˜å‚¨äº§å“æ¶æ„é•¿ä»€ä¹ˆæ ·</span>
            <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
          </a>
        <a class="next" href="/post/interview/job/1-2025-5-job/">
            <span class="next-text nav-default">åç«¯å¼€å‘å·¥ç¨‹å¸ˆé¢ç»</span>
            <span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
            repo="wangcy6/wangcy6.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:wang_cyi@163.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/wangcy6" class="iconfont icon-github" title="github"></a>
  <a href="https://wangcy6.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://gohugo.io">Hugo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> æœ¬ç«™æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> æ¬¡ </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> æœ¬ç«™æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> äºº </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2017 - 
    2025
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Troy</span>
  </span>
</div>
<script src="https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget/autoload.js"></script>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js" integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js" integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin="anonymous"></script>
  <script><!-- NOTE: timeago.js uses the language code format like "zh_CN" (underscore and case sensitive) -->
    var languageCode = "zh-cn".replace(/-/g, '_').replace(/_(.*)/, function ($0, $1) {return $0.replace($1, $1.toUpperCase());});
    timeago().render(document.querySelectorAll('.timeago'), languageCode);
    timeago.cancel();  
  </script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-138883536-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
