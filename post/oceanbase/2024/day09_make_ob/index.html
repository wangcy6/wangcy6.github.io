<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>æˆä¸ºobè´¡çŒ®è€…(09):å¦‚ä½•è¯æ˜é‡‡ç”¨äº†PALFè®¾è®¡å°±æ˜¯å®‰å…¨çš„ - Troyçš„ç½‘ç»œåšå®¢</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Troy" /><meta name="description" content="è‡ªæˆ‘é©±åŠ¨å­¦ä¹ " /><meta name="keywords" content="daily-interview-question, Github, c&#43;&#43;, Leetcode é¢˜è§£, åç«¯é¢è¯•" />






<meta name="generator" content="Hugo 0.83.1 with theme even" />


<link rel="canonical" href="https://wangcy6.github.io/post/oceanbase/2024/day09_make_ob/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="æˆä¸ºobè´¡çŒ®è€…(09):å¦‚ä½•è¯æ˜é‡‡ç”¨äº†PALFè®¾è®¡å°±æ˜¯å®‰å…¨çš„" />
<meta property="og:description" content="è‡ªæˆ‘é©±åŠ¨å­¦ä¹ " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://wangcy6.github.io/post/oceanbase/2024/day09_make_ob/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2024-12-21T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2024-12-21T00:00:00&#43;00:00" />

<meta itemprop="name" content="æˆä¸ºobè´¡çŒ®è€…(09):å¦‚ä½•è¯æ˜é‡‡ç”¨äº†PALFè®¾è®¡å°±æ˜¯å®‰å…¨çš„">
<meta itemprop="description" content="è‡ªæˆ‘é©±åŠ¨å­¦ä¹ "><meta itemprop="datePublished" content="2024-12-21T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2024-12-21T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="7649">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="æˆä¸ºobè´¡çŒ®è€…(09):å¦‚ä½•è¯æ˜é‡‡ç”¨äº†PALFè®¾è®¡å°±æ˜¯å®‰å…¨çš„"/>
<meta name="twitter:description" content="è‡ªæˆ‘é©±åŠ¨å­¦ä¹ "/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->
<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">
</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Even</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">é¦–é¡µ</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">å½’æ¡£</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">åˆ†ç±»</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">æ ‡ç­¾</li>
      </a><a href="https://github.com/wangcy6/weekly/tree/master/book">
        <li class="mobile-menu-item">é˜…è¯»æ¸…å•</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">å…³äºæˆ‘</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Even</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">é¦–é¡µ</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">å½’æ¡£</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">åˆ†ç±»</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">æ ‡ç­¾</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://github.com/wangcy6/weekly/tree/master/book">é˜…è¯»æ¸…å•</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">å…³äºæˆ‘</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">æˆä¸ºobè´¡çŒ®è€…(09):å¦‚ä½•è¯æ˜é‡‡ç”¨äº†PALFè®¾è®¡å°±æ˜¯å®‰å…¨çš„</h1>

      <div class="post-meta">
        <span class="post-time"> 2024-12-21 00:00 </span>
        <div class="post-category">
            <a href="/categories/oceanbase/"> oceanbase </a>
            </div>
          <span class="more-meta"> çº¦ 7649 å­— </span>
          <span class="more-meta"> é¢„è®¡é˜…è¯» 16 åˆ†é’Ÿ </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> æ¬¡é˜…è¯» </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#leader-election">Leader Election</a></li>
        <li><a href="#basic-paxoså®ç°-æœ€é•¿æ—¥å¿—-the-longest-logsé‡æ–°ç¡®è®¤reconfirmationç®—æ³•">Basic Paxoså®ç° æœ€é•¿æ—¥å¿—ï¼ˆ the longest logsï¼‰é‡æ–°ç¡®è®¤ï¼ˆreconfirmationï¼‰ç®—æ³•</a></li>
        <li><a href="#ä¸¾ä¾‹è¯´æ˜">ä¸¾ä¾‹è¯´æ˜</a></li>
        <li><a href="#æ—¥å¿—å¤åˆ¶-log-replication">æ—¥å¿—å¤åˆ¶ Log Replication</a></li>
        <li><a href="#1ä»€ä¹ˆæ˜¯raft">1.ä»€ä¹ˆæ˜¯raft</a></li>
        <li><a href="#entryæ ¼å¼">Entryæ ¼å¼</a></li>
      </ul>
    </li>
    <li><a href="#raftç®—æ³•ä¿è¯çš„æ€§è´¨">raftç®—æ³•ä¿è¯çš„æ€§è´¨</a>
      <ul>
        <li><a href="#2--palf-æ—¥å¿—å¤åˆ¶">2.  PALF æ—¥å¿—å¤åˆ¶</a></li>
        <li><a href="#3-å®‰å…¨æ€§ä¸åŒåœ°æ–¹åœ¨å“ªé‡Œ">3 .å®‰å…¨æ€§ä¸åŒåœ°æ–¹åœ¨å“ªé‡Œ</a></li>
        <li><a href="#log-replication">Log Replication</a></li>
        <li><a href="#correctness">Correctness</a></li>
      </ul>
    </li>
    <li><a href="#41-ç« èŠ‚-æ˜ç¡®çš„æ‰§è¡Œç»“æœ">4.1 ç« èŠ‚ æ˜ç¡®çš„æ‰§è¡Œç»“æœ</a></li>
    <li><a href="#è¯¾åä½œä¸š">è¯¾åä½œä¸š</a></li>
    <li><a href="#todo2paxos-è¯•é¢˜çœ‹çœ‹ä½ èƒ½å¾—å¤šå°‘åˆ†">TODO2:Paxos è¯•é¢˜ï¼Œçœ‹çœ‹ä½ èƒ½å¾—å¤šå°‘åˆ†</a></li>
    <li><a href="#å‚è€ƒ">å‚è€ƒ</a></li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#1-oceanbase-paxosstore-æºç é˜…è¯»">[1] Oceanbase PaxosStore æºç é˜…è¯»</a></li>
        <li><a href="#æ²Ÿé€šæ­¥éª¤">æ²Ÿé€šæ­¥éª¤</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <hr>
<p>title: æˆä¸ºobè´¡çŒ®è€…(6):å¦‚ä½•é˜…è¯»Paxosä»£ç 
date: 2024-10-04
description: è‡ªæˆ‘é©±åŠ¨å­¦ä¹ ï¼Œä¸“ä¸šä¸Šåªèƒ½é è‡ªå·±
categories:</p>
<ul>
<li>oceanbase</li>
</ul>
<hr>
<p><strong>æ¸©æ•…è€ŒçŸ¥æ–°ï¼š</strong></p>
<p>æˆä¸ºobè´¡çŒ®è€…(08):æ¥å£å±‚ PALFå›é¡¾</p>
<p><strong>å°ç‹æé—®ï¼š</strong> åœ¨PALFè®¾è®¡ä¸­æåˆ°å‰¯æœ¬çš„æ—¥å¿—ç³»ç»Ÿï¼ˆreplicated logging systemï¼‰ï¼Œå¦‚ä½•ç†è§£ï¼Ÿ</p>
<p><strong>è€ç‹å›ç­”ï¼š</strong></p>
<ul>
<li>å‡½æ•°è°ƒç”¨ç†è§£å—ï¼Ÿ</li>
<li>RPCï¼Œå°±åƒè°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·è°ƒç”¨å…¶ä»–èŠ‚ç‚¹ä¸Šçš„å‡½æ•°ï¼Œéšè—äº†ç½‘ç»œé€šä¿¡çš„ç»†èŠ‚ï¼Œè¿™ä¸ªä¹Ÿç†è§£å§ï¼Ÿ</li>
<li>Linuxç³»ç»Ÿæ ‡å‡†IOå‡½æ•°readã€writeç†è§£å§ï¼Ÿ</li>
<li>é€šè¿‡PALFæ¥å£å±‚ ï¼Œäº‹åŠ¡å¼•æ“å¯ä»¥æŠŠredoæ—¥å¿—åƒæœ¬åœ°ä¸€æ ·å†™åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œå› æ­¤å¼ºä¸€è‡´æ€§åè®®å®ç°ï¼Œç½‘ç»œä¼ è¾“çš„ç»†èŠ‚
åŒæ ·ï¼Œ<strong>æ ¹æ®åºåˆ—å·ï¼Œæˆ‘ä»¬å¯ä»¥åƒè¯»æœ¬åœ°ä¸€æ ·è¯»å…¶ä»–èŠ‚ç‚¹çš„æ•°æ®</strong>ã€‚ç†è§£äº†å§ã€‚
<img src="https://cdn.nlark.com/yuque/0/2024/png/215144/1734621005559-c6125a15-dc1b-49d7-8ff8-33f23077f8af.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1256%2Climit_0" alt="1734621005559-c6125a15-dc1b-49d7-8ff8-33f23077f8af.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1256%2Climit_0"></li>
</ul>
<p><strong>é€šè¿‡æœ¬æ–‡ä½ è·å¾—å¦‚ä¸‹æ”¶ç›Šï¼š</strong></p>
<p>æœ‰äº†å¼ºä¸€è‡´æ€§åè®®Paxosã€‚</p>
<ul>
<li>é¢†å¯¼é€‰ä¸¾ç®—æ³•å¯ä»¥ç”¨å®ƒã€‚</li>
<li>æœ€é•¿æ—¥å¿—ï¼ˆ the longest logsï¼‰é‡æ–°ç¡®è®¤ï¼ˆreconfirmationï¼‰ç®—æ³•å¯ä»¥ç”¨å®ƒ</li>
<li>ç”šè‡³æ—¥å¿—å¤åˆ¶ æœ¬èº«ä¹Ÿå¯ä»¥ç”¨å®ƒã€‚</li>
</ul>
<p>å°ç‹æé—®ï¼šå¤ªæŠ½è±¡äº†ï¼Œä¸çŸ¥é“è¯´æ˜¯ä»€ä¹ˆï¼Ÿè¯¥æ€ä¹ˆå…¥æ‰‹å‘¢</p>
<p>è€ç‹å›ç­”ï¼š
å¥½å§ï¼ŒPALFä¸­ pending follower å’Œstate machine safety æåˆ°4.1ç« èŠ‚ï¼Œ
é‡ç‚¹çœ‹è¿™ä¸ªå§ï¼Œç„¶åå®Œæˆä¸‹é¢2ä¸ªä½œä¸š</p>
<blockquote>
<ol>
<li>å¦‚ä½•è¯æ˜è¯æ˜ PALF æ˜¯å®‰å…¨çš„</li>
<li>å›ç­”PALF ä¸raftå·®å¼‚</li>
</ol>
</blockquote>
<p>raftè½¬æˆä¸‹é¢3ä¸ªå­é—®é¢˜</p>
<ul>
<li>
<p>Leaderé€‰ä¸¾</p>
</li>
<li>
<p>Logå¤åˆ¶</p>
</li>
<li>
<p>å®‰å…¨æ€§ä¿è¯
PALF è½¬æ¢ä¸‹é¢5ä¸ªå­é—®é¢˜</p>
</li>
<li>
<p>é€‰ä¸¾å®‰å…¨æ€§ï¼ˆæ—¥å¿—é‡æ–°ç¡®è®¤ï¼Œæ ¹æ®ä¼˜å…ˆçº§é€‰ä¸¾ï¼Œç„¶åè·å–æœ€æ–°æ—¥å¿—æ¥ä¿è¯ï¼‰</p>
</li>
<li>
<p>é¢†å¯¼è€…åªè¿½åŠ æ¨¡å¼ã€ï¼ˆ PALF é‡‡ç”¨ Raft çš„æ—¥å¿—å¤åˆ¶æ–¹æ¡ˆï¼Œraftä¿è¯äº†å®ƒæ˜¯å¯¹çš„ï¼‰</p>
</li>
<li>
<p>æ—¥å¿—åŒ¹é…ã€ï¼ˆPALF é‡‡ç”¨ Raft çš„æ—¥å¿—å¤åˆ¶æ–¹æ¡ˆï¼Œraftä¿è¯äº†å®ƒæ˜¯å¯¹çš„ï¼‰</p>
</li>
<li>
<p>é¢†å¯¼è€…å®Œæ•´æ€§ï¼ˆæ—¥å¿—é‡æ–°ç¡®è®¤æ¥ä¿è¯ï¼‰</p>
</li>
<li>
<p>çŠ¶æ€æœºå®‰å…¨æ€§ï¼ˆå·²ç»å†™å…¥ä¸èƒ½è¢«ä¿®æ”¹ã€‚<strong>å¦‚ä¸‹å›¾æ€ä¹ˆè¯æ˜å‘¢</strong>ï¼‰</p>
</li>
</ul>
<p>è‹±æ–‡å•è¯</p>
<ul>
<li>election safety</li>
<li>leader append-only</li>
<li>log matching,</li>
<li>leader completeness,</li>
<li>state machine safety
<img src="https://cdn.nlark.com/yuque/0/2024/png/215144/1734682545213-e4e46bcb-df76-4f40-a566-74c8b3a4db07.png?x-oss-process=image%2Fformat%2Cwebp" alt="å›¾ç‰‡1"></li>
</ul>
<ol>
<li>æ•æ‰æƒ³æ³•:<br>
æ— æ•°ä¸ªé—®é¢˜åŒæ—¶å‡ºç°ï¼Œè®©æ€è·¯æ›´åŠ æ··ä¹±ï¼Œä½†æ˜¯æè¿°ä¸å‡ºæ¥å…·ä½“æ˜¯ä»€ä¹ˆé—®é¢˜ã€‚
å‡­ç€æ„Ÿè§‰  å¼€å§‹é›†ä¸­ç²¾åŠ›é˜…è¯»é‡ç‚¹æ–‡ç« </li>
</ol>
<ul>
<li>PALF: Replicated Write-Ahead Logging for Distributed Databases</li>
</ul>
<ol start="2">
<li>åŠ¨æ‰‹éªŒè¯</li>
</ol>
<blockquote>
<p>ä»»åŠ¡1ï¼šç¿»è¯‘ï¼šPALF: Replicated Write-Ahead Logging for Distributed Databases</p>
<p>ä»»åŠ¡2ï¼šåšç»ƒä¹ é¢˜ï¼š#Paxos è¯•é¢˜ çœ‹çœ‹ä½ èƒ½å¾—å¤šå°‘åˆ†</p>
</blockquote>
<p>å¼€å§‹ï¼š</p>
<h3 id="leader-election">Leader Election</h3>
<p>![[Pasted image 20241217091033.png]]</p>
<p>å°ç‹æé—®ï¼šä»€ä¹ˆæ˜¯ pending follower,å’Œä¸Šä¸€ä¸ªleaderæœªæäº¤çš„æ—¥å¿—æœ‰å…³ç³»å—ï¼Ÿ ï¼ˆ4.1ç« èŠ‚æœ‰è§£é‡Š</p>
<p><strong>pending followerï¼š</strong>
The reason for switching to  pending follower rather than follower is that the transaction engine<br>
may have appended some logs to the leader before the <strong>leadership</strong><br>
<strong>transfer</strong>.</p>
<p>To determine the replication results of these pending logs,<br>
**pending followerand wait<br>
for logs from the new leader (Â§4.1). After the status of all pending<br>
logs is clear, the replica will switch to follower.</p>
<p>å½“ä¸€ä¸ªæœåŠ¡å™¨ï¼ˆå‰é¢†å¯¼è€…ï¼‰å¤±å»é¢†å¯¼åœ°ä½åï¼Œå®ƒä¸ä¼šç«‹å³å˜æˆæ™®é€šçš„è¿½éšè€…ï¼ˆfollowerï¼‰ï¼Œè€Œæ˜¯å…ˆå˜æˆä¸€ä¸ªå¾…å®šçš„è¿½éšè€…ï¼ˆpending followerï¼‰ã€‚</p>
<p>è¿™æ ·åšçš„åŸå› æ˜¯å› ä¸ºåœ¨é¢†å¯¼æƒè½¬ç§»ä¹‹å‰ï¼Œäº‹åŠ¡å¼•æ“å¯èƒ½å·²ç»åœ¨é¢†å¯¼è€…ä¸Šè¿½åŠ äº†ä¸€äº›æ—¥å¿—æ¡ç›®ã€‚</p>
<p>ä¸ºäº†ç¡®å®šè¿™äº›å¾…å®šæ—¥å¿—çš„å¤åˆ¶ç»“æœï¼Œå‰é¢†å¯¼è€…å¿…é¡»è¿›å…¥å¾…å®šè¿½éšè€…è§’è‰²ï¼Œå¹¶ç­‰å¾…æ¥è‡ªæ–°é¢†å¯¼è€…çš„æ—¥å¿—ã€‚ä»¥ä¸‹æ˜¯è¿™ä¸ªè¿‡ç¨‹çš„å‡ ä¸ªå…³é”®ç‚¹ï¼š</p>
<ol>
<li>
<p><strong>å¾…å®šæ—¥å¿—çš„å¤„ç†</strong>ï¼šå‰é¢†å¯¼è€…å¯èƒ½åœ¨å…¶æ—¥å¿—ä¸­æœ‰ä¸€äº›æœªè¢«å¤åˆ¶æˆ–æœªè¢«æäº¤çš„æ¡ç›®ï¼Œè¿™äº›è¢«ç§°ä¸ºå¾…å®šæ—¥å¿—ï¼ˆpending logsï¼‰ã€‚è¿™äº›æ—¥å¿—çš„å¤åˆ¶ç»“æœæœªçŸ¥ï¼Œéœ€è¦é€šè¿‡ä¸æ–°é¢†å¯¼è€…çš„é€šä¿¡æ¥ç¡®å®šã€‚</p>
</li>
<li>
<p><strong>ç­‰å¾…æ–°é¢†å¯¼è€…çš„æ—¥å¿—</strong>ï¼šä½œä¸ºå¾…å®šè¿½éšè€…ï¼Œå‰é¢†å¯¼è€…ä¼šç­‰å¾…æ–°é¢†å¯¼è€…å‘é€çš„æ—¥å¿—æ¡ç›®ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­</p>
</li>
</ol>
<p>å…·ä½“ç­‰çœ‹åˆ°4.1ç« èŠ‚æ—¶å€™æ‰æœ‰æ˜ç¡®ç­”æ¡ˆã€‚</p>
<hr>
<p><strong>é€‰ä¸¾ç®—æ³•</strong></p>
<p>é€‰ä¸¾ç®—æ³•ï¼Œä½œä¸º Basic Paxosç®—æ³•çš„ä¸€ä¸ªå˜ä½“ï¼Œå…¶æ ¸å¿ƒä»»åŠ¡æ˜¯é€‰ä¸¾å‡ºä¼˜å…ˆçº§æœ€é«˜çš„å‰¯æœ¬ä½œä¸ºLeaderã€‚æœ¬æ–‡çš„ç„¦ç‚¹é›†ä¸­åœ¨æ—¥å¿—å¤åˆ¶ä¸Šï¼Œè€Œéé€‰ä¸¾ç®—æ³•æœ¬èº«ã€‚</p>
<p><strong>è¾…åŠ©ç†è§£</strong></p>
<ol>
<li>é€‰ä¸¾ç®—æ³•çš„å®ç°ä¾æ‰˜äºPaxosç®—æ³•ï¼Œå¹¶éé€šè¿‡HAï¼ˆé«˜å¯ç”¨æ€§ï¼‰ç­‰å…¶ä»–æ–¹å¼æ¥å®ç°ã€‚</li>
<li>Basic Paxosç®—æ³•é€šè¿‡ä¸¤æ¬¡RPC ç¡®å®šä¸€ä¸ªå€¼ã€‚</li>
<li>æœ€é«˜ä¼˜å…ˆçº§ ä¹Ÿæ˜¯ä¸€ä¸ªå€¼ï¼Œå¯ç”¨<strong>Basic Paxos</strong>å®ç°</li>
</ol>
<p>åŸæ–‡ï¼š
The election algorithm is  essentially a variant of <strong>Basic Paxos</strong>, it reaches a <strong>consensus</strong> about  which replica owns the highest priority in a majority</p>
<p>This paper focuses the design of the replicated<br>
logging system, therefore, we leave implementation details of the<br>
election algorithm for another paper</p>
<h3 id="basic-paxoså®ç°-æœ€é•¿æ—¥å¿—-the-longest-logsé‡æ–°ç¡®è®¤reconfirmationç®—æ³•">Basic Paxoså®ç° æœ€é•¿æ—¥å¿—ï¼ˆ the longest logsï¼‰é‡æ–°ç¡®è®¤ï¼ˆreconfirmationï¼‰ç®—æ³•</h3>
<p>æ ¹æ®ä¸Šæ–‡ï¼Œé¢†å¯¼é€‰ä¸¾æ˜¯æ ¹æ®ä¼˜å…ˆçº§é€‰ä¸¾çš„ï¼Œ ä¸æ˜¯æ ¹æ®æœ€é•¿æ—¥å¿—é€‰ä¸¾çš„ï¼Œ
è‡ªç„¶æ–°çš„å€™é€‰äººæ—¥å¿—è¿œè¿œè½åå…¶ä»–èŠ‚ç‚¹ï¼Œ</p>
<p>å€™é€‰äººæ—¥å¿—ä¸æ˜¯æœ€æ–°æ—¥å¿—ï¼Œå…¶ä»–èŠ‚ç‚¹æ—¥å¿—æ˜¯æœ€æ–°çš„ã€‚
è¿™ä¸ªåœºæ™¯ä¸èƒ½æŒ‰ç…§å€™é€‰äººæ—¥å¿—è¦†ç›–å…¶ä»–èŠ‚ç‚¹çš„æ—¥å¿—</p>
<p>å› æ­¤éœ€è¦å¤šä¸ªèŠ‚ç‚¹å¯¹<strong>æœ€å¤§æ—¥å¿—è¿™ä¸€ä¸ªæ•°</strong>å€¼è¾¾æˆä¸€è‡´ã€‚</p>
<p>å›é¡¾ï¼š
æ ¹æ®&laquo;æˆä¸ºOBè´¡çŒ®è€…ç¬¬å››å¤©ï¼šä»å•ç‚¹åˆ°å¤šèŠ‚ç‚¹ i++å¹¶å‘æ–¹æ¡ˆ &raquo;
<a href="https://open.oceanbase.com/blog/14180550530">https://open.oceanbase.com/blog/14180550530</a>
<img src="https://obcommunityprod.oss-cn-shanghai.aliyuncs.com/prod/blog/2024-09/1726543331323.png" alt="img"></p>
<blockquote>
<p>è‡ªç„¶Basic Paxosæ»¡è¶³è¿™ä¸ªç‰¹ç‚¹ï¼Œï¼ˆå‡å¦‚ç³»ç»Ÿåªå†™ä¸€ä¸ªå€¼ï¼‰
Paxosåˆ†ä¸º2ä¸ªé˜¶æ®µ Prepareï¼Œ Accept ã€‚ &mdash;å›¾2
åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œ åœ¨Accept é˜¶æ®µ å·²ç»å†™å…¥ææ¡ˆï¼ˆæ²¡æœ‰è¢«å¤§å¤šæ•°èŠ‚ç‚¹æ¥å—ï¼‰ï¼Œä½†æ˜¯æè®®è€…å¯è§ï¼ˆè¿ç”¨å¤šæ•°æ´¾æŸ¥è¯¢åˆ°ï¼‰ä¸èƒ½è¢«ä¿®æ”¹ã€‚
s1 å‘èµ·3.1 ææ¡ˆï¼Œs5. å‘èµ·4.5ææ¡ˆï¼Œ 2ä¸ªä¸åŒçš„ææ¡ˆç¼–å·ï¼Œä½†æ˜¯å†™å…¥éƒ½æ˜¯åŒä¸€ä¸ªå€¼x &ndash;å›¾1</p>
</blockquote>
<p><img src="https://obcommunityprod.oss-cn-shanghai.aliyuncs.com/prod/blog/2024-09/1726543481005.png" alt=""></p>
<pre><code>   å›¾ç‰‡1 æƒ…å†µ2 ææ¡ˆè¢«æ¥å—ï¼Œæè®®è€…å¯è§
</code></pre>
<p><img src="https://obcommunityprod.oss-cn-shanghai.aliyuncs.com/prod/blog/2024-09/1726543417539.png" alt=""></p>
<pre><code>              å›¾2ï¼š 
</code></pre>
<hr>
<p>å¦‚å›¾ï¼šæœ€é•¿æ—¥å¿—ï¼ˆ the longest logsï¼‰ç¡®è®¤ç®—æ³•</p>
<p>ï¼ˆs5. å‘èµ·4.5ææ¡ˆï¼Œä½†æ˜¯s1 å‘èµ·3.1 ææ¡ˆéƒ¨åˆ†å†™å…¥ï¼Œ 2ä¸ªä¸åŒçš„ææ¡ˆç¼–å·ï¼Œä½†æ˜¯å†™å…¥éƒ½æ˜¯åŒä¸€ä¸ªå€¼x æ˜¯ä¸æ˜¯æœ‰ç‚¹ç±»ä¼¼ï¼Ÿ<strong>å¯¹ä¸€ä¸ªå€¼è¾¾æˆä¸€è‡´</strong>ï¼‰
<img src="https://cdn.nlark.com/yuque/0/2024/png/215144/1734618996253-fce72585-110b-4cd3-a7a0-afbbc36177dd.png?x-oss-process=image%2Fformat%2Cwebp" alt=""></p>
<p><strong>æ—¥å¿—é‡æ–°ç¡®è®¤ç®—æ³•ï¼ˆAlg.1ï¼‰</strong></p>
<ol>
<li><strong>å‡†å¤‡é˜¶æ®µï¼ˆPaxos Prepareæ¶ˆæ¯å¹¿æ’­ï¼‰</strong>
<ul>
<li>å€™é€‰äººå‘æ‰€æœ‰å‰¯æœ¬å¹¿æ’­å¸¦æœ‰é«˜çº§ProposalIDï¼ˆé¢†å¯¼ä»»æœŸçš„æ ‡è¯†ç¬¦ï¼‰<code>ğ‘ğ‘–ğ‘‘ + 1</code>çš„Paxos Prepareæ¶ˆæ¯ï¼ˆç¬¬2è¡Œï¼‰&mdash;pid ç†è§£æˆææ¡ˆç¼–å·</li>
<li>æ¯ä¸ªå‰¯æœ¬å°†å­˜å‚¨Prepareæ¶ˆæ¯ä¸­çš„<code>ğ‘ğ‘–ğ‘‘</code>ï¼Œå¹¶ä¸”åªæœ‰å½“Prepareæ¶ˆæ¯ä¸­çš„<code>ğ‘ğ‘–ğ‘‘</code>å¤§äºå‰¯æœ¬æ‰€è§è¿‡çš„æœ€å¤§ProposalID <code>ğ‘ğ‘–ğ‘‘ğ‘šğ‘ğ‘¥</code>æ—¶ï¼Œæ‰ä¼šå‘å€™é€‰äººå“åº”å…¶æ—¥å¿—ï¼ˆç¬¬9è¡Œï¼‰ã€‚</li>
<li>ä¸ºäº†é¿å…ä¼ è¾“æ— ç”¨çš„æ—¥å¿—ï¼ŒPrepareæ¶ˆæ¯çš„ç¡®è®¤åªåŒ…å«æ—¥å¿—çš„å°¾éƒ¨LSNã€‚</li>
</ul>
</li>
<li><strong>æ¥å—é˜¶æ®µï¼ˆPaxos Acceptï¼‰</strong>
<ul>
<li>ä¸€æ—¦å€™é€‰äººä»å¤§å¤šæ•°å‰¯æœ¬æ”¶åˆ°æŠ•ç¥¨ï¼ˆç¬¬3è¡Œï¼‰ï¼Œå®ƒå°±å¼€å§‹Paxosæ¥å—é˜¶æ®µï¼š
<ul>
<li>é€‰æ‹©æ—¥å¿—æœ€é•¿çš„å‰¯æœ¬ï¼ˆç¬¬4è¡Œï¼‰
//selecting the replica with the longest logs
//å¯¹æ¯” å›¾ç‰‡1 æƒ…å†µ2 ææ¡ˆè¢«æ¥å—ï¼Œæè®®è€…å¯è§.</li>
<li>ä»è¯¥å‰¯æœ¬è·å–æ—¥å¿—ï¼ˆç¬¬5è¡Œï¼‰ã€‚
// int read(LSN lsn, Record &amp;r);  //æ ¹æ®LSNéšæœºè¯»ä½ç½® PALFã€‚</li>
<li>å°†è¿™äº›æ—¥å¿—å¤åˆ¶åˆ°æ‰€æœ‰å‰¯æœ¬ï¼ˆç¬¬6è¡Œï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><strong>å¯åŠ¨å·¥ä½œæ—¥å¿—å¤åˆ¶</strong>
<ul>
<li>æœ€åï¼Œå€™é€‰äººå°†StartWorkingæ—¥å¿—å¤åˆ¶åˆ°æ‰€æœ‰å‰¯æœ¬ï¼ˆç¬¬8è¡Œï¼‰ã€‚</li>
<li>æ³¨æ„ï¼ŒStartWorkingæ—¥å¿—æ˜¯ä¸€ç§ç‰¹æ®Šçš„é‡æ–°é…ç½®æ—¥å¿—ï¼ˆÂ§5.3ï¼‰ï¼Œç”¨äºå›æ»šå‰é¢†å¯¼å¯èƒ½æœªæäº¤çš„æˆå‘˜èµ„æ ¼ã€‚</li>
<li>åªè¦StartWorkingæ—¥å¿—è¾¾åˆ°å¤§å¤šæ•°ï¼Œå€™é€‰äººå°±ä¼šæ‹…ä»»é¢†å¯¼èŒè´£ã€‚</li>
</ul>
</li>
</ol>
<blockquote>
<p>è¯¾åä½œä¸š å¯¹æ¯”Rafté¢†å¯¼è€…å˜æ›´çš„å®‰å…¨æ€§</p>
</blockquote>
<h3 id="ä¸¾ä¾‹è¯´æ˜">ä¸¾ä¾‹è¯´æ˜</h3>
<p>å‡è®¾ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ‰ä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li><strong>å‰ä»»é¢†å¯¼è€…</strong>ï¼šåœ¨ä»»æœŸT1ä¸­ï¼Œé¢†å¯¼è€…å°è¯•æ·»åŠ ä¸€ä¸ªæ–°çš„æˆå‘˜åˆ°é›†ç¾¤ä¸­ï¼Œä½†è¿™ä¸ªå˜æ›´æ²¡æœ‰è¢«æäº¤ï¼ˆå³æ²¡æœ‰å¤åˆ¶åˆ°å¤šæ•°èŠ‚ç‚¹ï¼‰ã€‚</li>
<li><strong>é¢†å¯¼è€…å¤±æ•ˆ</strong>ï¼šéšåï¼Œå‰ä»»é¢†å¯¼è€…å› ä¸ºæŸäº›åŸå› å¤±æ•ˆã€‚</li>
<li><strong>æ–°é¢†å¯¼è€…é€‰ä¸¾</strong>ï¼šåœ¨ä»»æœŸT2ä¸­ï¼Œæ–°çš„é¢†å¯¼è€…è¢«é€‰ä¸¾å‡ºæ¥ã€‚</li>
</ul>
<p>åœ¨Raftä¸­ï¼Œä»¥ä¸‹æ˜¯å‘ç”Ÿçš„æƒ…å†µï¼š</p>
<ul>
<li><strong>æ—¥å¿—ä¸€è‡´æ€§æ£€æŸ¥</strong>ï¼šæ–°é¢†å¯¼è€…ä¼šå‘ç°å‰ä»»é¢†å¯¼è€…æœªæäº¤çš„æˆå‘˜å˜æ›´ã€‚ç”±äºè¿™ä¸ªå˜æ›´æ²¡æœ‰è¢«å¤šæ•°èŠ‚ç‚¹æ¥å—ï¼Œæ–°é¢†å¯¼è€…ä¸ä¼šå°†å…¶è§†ä¸ºæœ‰æ•ˆå˜æ›´ã€‚</li>
<li><strong>è¦†ç›–ä¸ä¸€è‡´çš„æ—¥å¿—</strong>ï¼šæ–°é¢†å¯¼è€…ä¼šç»§ç»­å¤åˆ¶å…¶è‡ªå·±çš„æ—¥å¿—æ¡ç›®ï¼Œè¦†ç›–å‰ä»»é¢†å¯¼è€…æœªæäº¤çš„å˜æ›´ã€‚è¿™ç¡®ä¿äº†ç³»ç»ŸçŠ¶æ€çš„ä¸€è‡´æ€§ã€‚</li>
</ul>
<p>åœ¨StartWorkingæ—¥å¿—çš„æœºåˆ¶ä¸­ï¼š</p>
<ul>
<li><strong>StartWorkingæ—¥å¿—</strong>ï¼šæ–°é¢†å¯¼è€…ä¼šå¤åˆ¶StartWorkingæ—¥å¿—åˆ°æ‰€æœ‰å‰¯æœ¬ã€‚è¿™ä¸ªæ—¥å¿—ä¼šåŒ…å«æŒ‡ä»¤æ¥å›æ»šå‰ä»»é¢†å¯¼è€…æœªæäº¤çš„æˆå‘˜å˜æ›´ã€‚</li>
<li><strong>å›æ»šæœªæäº¤å˜æ›´</strong>ï¼šé€šè¿‡å¤åˆ¶StartWorkingæ—¥å¿—ï¼Œæ–°é¢†å¯¼è€…ç¡®ä¿æ‰€æœ‰å‰¯æœ¬éƒ½è®¤åŒå›æ»šæœªæäº¤çš„æˆå‘˜å˜æ›´ã€‚è¿™ä¿è¯äº†å³ä½¿åœ¨æ–°é¢†å¯¼è€…æ¥ç®¡åï¼Œç³»ç»Ÿçš„é…ç½®çŠ¶æ€ä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚</li>
</ul>
<hr>
<p>åŸæ–‡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Due to flexible leader election, the candidate may have fewer logs than other replicas. Before taking over as  a leader, the candidate should re-confirm the logs appended by the  
previous leader to guarantee that its logs are not fewer than any  
replica in a majority. The log reconfirmation (Alg.1) is essentially a  complete instance of Basic Paxos [27]. Specifically, the candidate  broadcasts the advanced ProposalID(identifier for the leaderâ€™s term)  ğ‘ğ‘–ğ‘‘ + 1 to all replicas with Paxos Prepare messages (line 2). 

Each  replica will store the ğ‘ğ‘–ğ‘‘ of the Prepare message, and respond to  
the candidate with its logs, only if the ğ‘ğ‘–ğ‘‘ in the Prepare message is.
larger than the maximum ProposalID ğ‘ğ‘–ğ‘‘ğ‘šğ‘ğ‘¥ the replica has seen  
(line 9). 

To avoid transporting useless logs, the acknowledgement  
of Prepare message only contains the tail LSN of logs.  

Once the candidate receives votes from any majority of replicas  
(line 3), it starts the Paxos accept phase: selecting the replica with  
the longest logs (line 4), getting logs from it (line 5), and replicating  
these logs to all replicas (line 6). 

Finally, the candidate replicates a  
StartWorking log to all replicas (line 8). Note that the StartWorking  
log is a special reconfiguration log (Â§5.3), it is used to roll back  
the possible uncommitted membership of the previous leader. 

The  candidate will serve as the leader as long as the StartWorking log  
reaches majority

</code></pre></td></tr></table>
</div>
</div><h3 id="æ—¥å¿—å¤åˆ¶-log-replication">æ—¥å¿—å¤åˆ¶ Log Replication</h3>
<blockquote>
<p>å¸¦ç€é—®é¢˜çœ‹æ–‡ç«  PALF æ—¥å¿—å¤åˆ¶ å’ŒRaftç±»ä¼¼ï¼Œçœ‹åˆ°è¿™å¥è¯å°å¿ƒï¼Œä¸ä¸€æ ·åœ°æ–¹åœ¨å“ªé‡Œ</p>
</blockquote>
<ol>
<li>é¦–å…ˆçœ‹Raftæ˜¯æ€ä¹ˆåšæ—¥å¿—åŒ¹é…çš„ï¼Œ</li>
<li>ä¸Raftä¸åŒç‚¹æ˜¯ä»€ä¹ˆ?</li>
<li>èƒ½ä¸¾ä¾‹è¯´æ˜å—ï¼Ÿ</li>
</ol>
<h3 id="1ä»€ä¹ˆæ˜¯raft">1.ä»€ä¹ˆæ˜¯raft</h3>
<ul>
<li>ä¸»è¦å‚è€ƒèµ„æ–™ï¼šRaftç®—æ³•ç²¾è¯»</li>
<li>æ¼”ç¤ºï¼šhttps://raft.github.io/</li>
<li><a href="https://pdos.csail.mit.edu/6.824/papers/raft-extended.pdf">https://pdos.csail.mit.edu/6.824/papers/raft-extended.pdf</a></li>
<li><a href="https://pdos.csail.mit.edu/6.824/papers/raft-faq.txt">https://pdos.csail.mit.edu/6.824/papers/raft-faq.txt</a></li>
</ul>
<p>raftç®—æ³•ä¹‹æ‰€ä»¥ç®€å•çš„åŸå› ä¹‹ä¸€æ˜¯å®ƒå°†é—®é¢˜åˆ†è§£æˆä¸‰ä¸ªå­é—®é¢˜ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ol>
<li>Leaderé€‰ä¸¾</li>
<li>Logå¤åˆ¶</li>
<li>å®‰å…¨æ€§ä¿è¯</li>
</ol>
<blockquote>
<p>å›¾3ï¼šæŒä¹…åŒ–å’ŒéæŒä¹…åŒ–çŠ¶æ€ï¼š</p>
</blockquote>
<p>æ€è€ƒï¼šRaft åè®®ä¸­å¦‚ä½•ç¡®ä¿æ˜“å¤±æ€§çŠ¶æ€ï¼ˆvolatile stateï¼‰åœ¨æœåŠ¡å™¨é‡å¯åé‡å»ºï¼Ÿ</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/215144/1734767369718-9ae087dd-f51c-4228-9923-f7062858104d.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_605%2Climit_0" alt="">
å›¾3ï¼šé€‰ä¸¾</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/215144/1734767355086-d9dbed31-5a32-481e-b892-7e3360408aa9.png" alt="">
<img src="https://cdn.nlark.com/yuque/0/2024/png/215144/1734767319402-4aaec552-9456-4101-a802-61e0510c7bf3.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_608%2Climit_0" alt=""></p>
<h3 id="entryæ ¼å¼">Entryæ ¼å¼</h3>
<p>Logsç”±Entriesç»„æˆï¼Œæ¯ä¸ªEntryåŒ…å«ä¸€ä¸ªtermå’Œå‘½ä»¤ï¼Œæ ¼å¼å¦‚ä¸‹</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/215144/1734769716982-c4bec496-4892-4c96-84f6-f966ae8894aa.png?x-oss-process=image%2Fformat%2Cwebp" alt="Entries"></p>
<h2 id="raftç®—æ³•ä¿è¯çš„æ€§è´¨">raftç®—æ³•ä¿è¯çš„æ€§è´¨</h2>
<ol>
<li><strong>Election Safety</strong>: at most one leader can be elected in a given term.</li>
<li><strong>Leader Append-Only</strong>: a leader never overwrites or deletes entries in its log; it only appends new entries.</li>
<li><strong>Log Matching</strong>: if two logs contain an entry with the same index and term, then the logs are identical in all entries up through the given index.</li>
<li><strong>Leader Completeness</strong>: if a log entry is committed in a given term, then that entry will be present in the logs of the leaders for all higher-numbered terms.</li>
<li><strong>State Machine Safety</strong>: if a server has applied a log entry at a given index to its state</li>
<li>machine, no other server will ever apply a different log entry for the same index.
æš‚æ—¶å¯ä»¥å…ˆä¸çœ‹ï¼Œéœ€è¦çŸ¥é“çš„æ˜¯raftæ‰€æœ‰çš„è§„åˆ™éƒ½æ˜¯ä¸ºäº†ä¿è¯ä¸Šé¢çš„è¿™äº›æ€§è´¨ï¼Œè€Œè¿™äº›æ€§è´¨åˆæ˜¯ä¿è¯raftæ­£ç¡®çš„å‰æã€‚</li>
</ol>
<p><strong>è¦æƒ³ç†è§£raftï¼Œå…¶å®å°±æ˜¯ææ˜ç™½ï¼š</strong></p>
<ol>
<li>leaderå’Œfolloweréœ€è¦ç»´æŠ¤å“ªäº›å˜é‡ï¼Œæ¯ä¸ªå˜é‡çš„å«ä¹‰</li>
<li>leaderä»€ä¹ˆæ—¶å€™å‘é€AppendEntries RPCï¼Œæºå¸¦å“ªäº›å‚æ•°ï¼Œfolloweræ”¶åˆ°è¯·æ±‚ååšä»€ä¹ˆï¼Ÿleaderæ”¶åˆ°å“åº”ååšä»€ä¹ˆï¼Ÿ</li>
<li>candidateä»€ä¹ˆæ—¶å€™å‘é€RequestVote RPCï¼Œæºå¸¦å“ªäº›å‚æ•°ï¼Œfolloweræ”¶åˆ°è¯·æ±‚ååšä»€ä¹ˆï¼Ÿcandidateæ”¶åˆ°å“åº”ååšä»€ä¹ˆï¼Ÿ</li>
</ol>
<p>å®‰å…¨æ€§ï¼š
ä»€ä¹ˆæƒ…å†µä¸‹Entryå¯ä»¥è¢«commitï¼Ÿæ»¡è¶³ä»¥ä¸‹<strong>ä¸¤ä¸ª</strong>æ¡ä»¶ï¼š</p>
<ol>
<li>A log entry is committed once the leader that created the entry has replicated it on a majority of the servers.ï¼ˆleaderå°†è¯¥entryæ‹·è´åˆ°å¤§éƒ¨åˆ†serverä¸­ï¼‰</li>
<li><strong>ä¸èƒ½commit termæ¯”å½“å‰leaderçš„termå°çš„Entryã€‚å’Œå‰é¢leaderé€‰ä¸¾é™åˆ¶ä¸€æ ·ï¼Œè¿™ä¹Ÿæ˜¯è®ºæ–‡åœ¨5.4 Safetyè¿™ä¸€å°èŠ‚ç»™çš„ä¸€ä¸ªrestriction</strong>ã€‚ä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Œè®ºæ–‡åœ¨5.4.2èŠ‚ç»™å‡ºäº†è§£é‡Š
<img src="https://cdn.nlark.com/yuque/0/2024/png/215144/1734767032169-43a91eb6-bc60-4d7a-9ab2-919966ef7464.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_694%2Climit_0" alt=""></li>
</ol>
<p>T1ï¼š å›¾cï¼š Aè¢«é€‰ä¸¾æˆleaderï¼Œ æ­¤æ—¶æœ‰ä¸Šä¸€ä¸ªä»»æœŸçš„term=2 ï¼Œindex=2ï¼Œå’Œterm=4 index=3çš„æ—¥å¿—</p>
<p>å‡å¦‚ å…ˆå¤„ç†index=2çš„æ—¥å¿—ï¼Œè¿™ä¸ªåšæ³•æ˜¯é”™è¯¯çš„ï¼Œ</p>
<p>T2ï¼šindex=2 term=2çš„æ—¥å¿—å¤åˆ¶çš„S3èŠ‚ç‚¹ï¼Œä½†æ˜¯æ²¡æœ‰commitedç¡®è®¤ï¼Œæ­¤æ—¶S1 crashã€‚</p>
<p>T3ï¼šå›¾d  S5å½“é€‰leader
ä¸ºä»€ä¹ˆï¼Œåªæœ‰S1 term=4 åå¯¹ å…¶ä»–åŒæ„ã€‚S5å½“é€‰é¢†å¯¼ã€‚</p>
<blockquote>
<p>è¯¥æ€ä¹ˆåš: index=2ï¼Œterm=2ï¼Œindex=3ï¼Œterm=4 ä¸€å—å¤åˆ¶</p>
</blockquote>
<p>å¦‚æœS1ç°åœ¨å¥”æºƒäº†ï¼ŒS5ä¸å¯èƒ½æˆä¸ºleaderï¼ˆS5çš„æœ€åä¸€ä¸ªEntryçš„term=3ï¼ŒS1, S2, S3éƒ½ä¼šæ‹’ç»æŠ•ç¥¨ï¼Œå› ä¸ºå®ƒä»¬çš„logsæ›´up-to-dateï¼‰ï¼Œä¹Ÿå°±ä¸å¯èƒ½å‡ºç°commitçš„Entryè¢«è¦†ç›–çš„æƒ…å†µã€‚</p>
<blockquote>
<p>å…³é”®ï¼šS5ä¸å¯èƒ½æˆä¸ºleader æ˜¯æ—¥å¿—ä¸­åŒ…å«termï¼Œå…ˆåŒæ­¥å½“å‰ä»»æœŸè¯·æ±‚ï¼Œåœ¨å¤„ç†å†å²ä»»æœŸè¯·æ±‚ã€‚
å¦‚æœå½“å‰termæ²¡æœ‰è¯·æ±‚ï¼Œæ„é€ ç©ºçš„è¯·æ±‚ï¼Œç„¶åä¸€èµ·å’Œå†å²ä»»æœŸè¯·æ±‚ä¸€å—å¤„ç†</p>
</blockquote>
<p>å°ç‹ï¼šè¿™ä¸ªè¿èƒŒå°è¯•å‘€ï¼Ÿè¿™ä¸ªæ²¡æœ‰ä¸¥æ ¼indexï¼Œä»å°åˆ°å¤§å¤„ç†</p>
<p>ä½œä¸šï¼šå¯¹æ¯”PALFæ€ä¹ˆå®ç°çš„å¤„ç†ä¸Šä¸€ä¸ªä»»æœŸçš„æ—¥å¿—å‘¢</p>
<h3 id="2--palf-æ—¥å¿—å¤åˆ¶">2.  PALF æ—¥å¿—å¤åˆ¶</h3>
<p>a log sequence number (LSN)</p>
<p>ç®€å•çš„æè¿°</p>
<ol>
<li>
<p>é¢†å¯¼è€…æ ¹æ®LSNäº§ç”Ÿæ—¥å¿—ï¼ˆlog entryï¼‰ï¼Œå¤åˆ¶å®Œæˆåï¼Œæœ€å æŒ‰LSNçš„é¡ºåºç”±é¢†å¯¼è€…æäº¤ï¼ˆcommittedï¼‰</p>
</li>
<li>
<p>å½“follower æ”¶åˆ°æ–°çš„æ–°çš„æ—¥å¿—ï¼ˆlog entryï¼‰ï¼Œ</p>
<ul>
<li>å¿…é¡»ä¿è¯å†å²æ—¥å¿—ï¼ˆpreceding logsï¼‰è¢«æ¥å—ï¼ˆacceptedï¼‰ç„¶åæ¥å—å½“å‰æ—¥å¿—</li>
<li>å¦‚æœåŒä¸€ä¸ªä½ç½®æœ‰å†²çªï¼ŒæŒ‰ç…§æœ€ææ¡ˆç¼–å·æ¥æˆªå–ã€‚</li>
</ul>
</li>
</ol>
<p>æ³¨æ„ accepted å’ŒcommittedåŒºåˆ«ï¼Œå¹¶ä¸” æ ¹æ®LSNé¡ºåºå¤„ç†ã€‚</p>
<blockquote>
<p>é¡ºåºå¤„ç† ä¸­é—´æœ‰ç©ºæ—¥å¿—å—ï¼Ÿ å…·ä½“æ›´éœ€ç»†èŠ‚æ–‡ç« æ²¡æœ‰æè¿°ï¼Œéœ€è¦æŸ¥èµ„æ–™ç¡®è®¤</p>
</blockquote>
<p>a log sequence number (LSN) å¤§å°ç­‰äº last the LSN + å½“å‰æ—¥å¿—å¤§å°</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/215144/1734682322323-9b615841-3646-4621-8778-70dad23dab8c.png?x-oss-process=image%2Fformat%2Cwebp" alt=""></p>
<h3 id="3-å®‰å…¨æ€§ä¸åŒåœ°æ–¹åœ¨å“ªé‡Œ">3 .å®‰å…¨æ€§ä¸åŒåœ°æ–¹åœ¨å“ªé‡Œ</h3>
<p>å¾—ç›Šäº Raft ä¸­çš„å®‰å…¨æ€§è®ºè¯ï¼Œæˆ‘ä»¬åªéœ€éªŒè¯ PALF æ˜¯å¦ç¡®ä¿ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li>é€‰ä¸¾å®‰å…¨æ€§ï¼ˆæ—¥å¿—é‡æ–°ç¡®è®¤ï¼Œæ ¹æ®ä¼˜å…ˆçº§é€‰ä¸¾ï¼Œç„¶åè·å–æœ€æ–°æ—¥å¿—ï¼‰</li>
<li>é¢†å¯¼è€…åªè¿½åŠ æ¨¡å¼ã€ï¼ˆraftæ¨¡å¼ PALF é‡‡ç”¨ Raft çš„æ—¥å¿—å¤åˆ¶æ–¹æ¡ˆï¼‰</li>
<li>æ—¥å¿—åŒ¹é…ã€ï¼ˆraftæ¨¡å¼ PALF è‡ªç„¶é‡‡ç”¨ Raft çš„æ—¥å¿—å¤åˆ¶æ–¹æ¡ˆï¼‰</li>
<li>é¢†å¯¼è€…å®Œæ•´æ€§ï¼ˆæ—¥å¿—é‡æ–°ç¡®è®¤ï¼‰</li>
<li>çŠ¶æ€æœºå®‰å…¨æ€§ï¼ˆå·²ç»å†™å…¥ä¸èƒ½è¢«ä¿®æ”¹ï¼‰</li>
</ul>
<p>Raftå’ŒPALFä¹‹é—´çš„å…³é”®åŒºåˆ«åœ¨äºæ—¥å¿—é‡æ–°ç¡®è®¤ã€‚
å€™é€‰è€…æ‰§è¡Œä¸€æ¬¡åŸºæœ¬Paxoså®ä¾‹ï¼Œä»¥ä»æ¥å—å¤§å¤šæ•°æ—¥å¿—çš„å‰¯æœ¬ä¸­å­¦ä¹ ç¼ºå¤±çš„æ—¥å¿—ã€‚</p>
<p>å¦‚æœå‰ä»»é¢†å¯¼è€…æäº¤çš„æ—¥å¿—æ¡ç›®å·²è¢«å¤šæ•°æ¥å—ï¼Œé‚£ä¹ˆå€™é€‰äººå¿…é¡»çœ‹åˆ°å¹¶å­¦ä¹ åˆ°è¿™ä¸€ç‚¹ï¼Œ
ä»è€Œç¡®ä¿äº†é€‰ä¸¾çš„å®‰å…¨æ€§å’Œé¢†å¯¼è€…çš„å®Œæ•´æ€§</p>
<p><strong>çŠ¶æ€æœºå®‰å…¨æ€§ä¸¾ä¾‹è¯´æ˜</strong></p>
<p>è¿™ä¸ªæ˜¯ä¾‹å­ï¼Œå®Œæ•´è¯æ˜çœ‹4.1ç« èŠ‚
We leave the proof of the state  machine safety property in Â§4.1</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/215144/1734682545213-e4e46bcb-df76-4f40-a566-74c8b3a4db07.png?x-oss-process=image%2Fformat%2Cwebp" alt=""></p>
<p>å¦‚å›¾6ï¼Œä¸€ä¸ªç³»ç»Ÿæœ‰ä¸‰ä¸ªèŠ‚ç‚¹A,B,Cç»„æˆï¼Œï¼ˆaï¼‰ï¼ˆbï¼‰ï¼ˆcï¼‰ ä»£è¡¨ä¸‰ä¸ªæ—¶åˆ»ã€‚</p>
<ol>
<li>
<p>aæ—¶é—´ç‚¹ï¼šèŠ‚ç‚¹Aæ˜¯leaderï¼Œå·²ç»æ¥å—æ—¥å¿—log1ã€log2å’Œlog3ã€‚
å…¶ä¸­æ—¥å¿—log1å·²ç»æäº¤åˆ°å…¨éƒ¨èŠ‚ç‚¹ï¼Œlog2 å†™å…¥å¤§å¤šæ•°èŠ‚ç‚¹ï¼Œlog3 æ²¡æœ‰å¼€å§‹å¤åˆ¶</p>
</li>
<li>
<p>bæ—¶é—´ç‚¹ï¼š
Aæš‚æ—¶ä¸Bå’ŒCå¤±å»è¿æ¥ Cè¢«é€‰ä¸ºæ–°çš„é¢†å¯¼è€…ï¼Œåˆ©ç”¨reconfirmedä»Bé‚£é‡Œé‡æ–°ç¡®è®¤äº†å½“å‰æœ€é•¿æ—¥å¿—log2ï¼Œç„¶åå¤åˆ¶åˆ°B å’ŒCèŠ‚ç‚¹</p>
</li>
<li>
<p>cæ—¶é—´ç‚¹:
å½“ç½‘ç»œæ¢å¤åï¼ˆå‚è§å›¾6cï¼‰ï¼Œå‰¯æœ¬Aè½¬å˜ä¸ºå¾…å®šçš„è¿½éšè€…çŠ¶æ€ï¼Œå› ä¸ºå®ƒçš„é€‰ä¸¾ç§ŸæœŸå·²ç»è¿‡æœŸã€‚å®ƒå¼€å§‹ä»æ–°é¢†å¯¼è€…Cé‚£é‡Œæ¥æ”¶æ—¥å¿—ï¼ŒAä¸­çš„log2ç”±äºå·²è¢«æ–°é¢†å¯¼è€…æäº¤ï¼Œå°†è¢«æ¥å—ã€‚</p>
</li>
</ol>
<p>ä¸æ­¤ç›¸åï¼ŒAä¸­çš„log3å°†è¢«æˆªæ–­ï¼Œå› ä¸ºCä¸­æœ‰ä¸€ä¸ªåŒ…å«æ›´å¤§ProposalIDçš„å¦ä¸€ä¸ªlog3ã€‚</p>
<p>The state machine safety property of the consensus protocol is<br>
ensured by the explicit replication results. If a log has been <strong>committed,</strong> it must have been applied to the leader and will be replayed<br>
to the follower. If PALF fails to reach consensus on the log, state<br>
machine of the <strong>previous leader will be rolled back</strong> by calling the<br>
failure function.</p>
<p><img src="https://cdn.nlark.com/yuque/__mermaid_v3/bbcd7921529875f7b7ba215178cf7754.svg" alt=""></p>
<p>åŸæ–‡ï¼š</p>
<h3 id="log-replication">Log Replication</h3>
<ul>
<li><strong>Responsibility of the Leader</strong>: Once a leader is elected in PALF, it becomes responsible for replicating and committing log entries across the cluster.</li>
<li><strong>Log Sequence Number (LSN)</strong>: When log entries are appended to the leader, each entry is assigned an LSN, which represents the physical offset in the log blocks where the entry is stored. The LSN for the next log entry is the sum of the current log&rsquo;s LSN and the size of the log.</li>
<li><strong>Log Storage</strong>: Log entries are stored in log blocks in LogStorage, and the LSN system allows clients to interact with PALF as if it were a normal file system.</li>
<li><strong>Order of Log Acceptance</strong>: Followers will only accept a log entry if all preceding entries have been accepted. If there&rsquo;s a conflict with a higher proposal number, PALF will truncate the conflicting logs, similar to Raft.</li>
</ul>
<h3 id="correctness">Correctness</h3>
<ul>
<li><strong>Properties to Validate</strong>: To ensure correctness, PALF must validate properties such as election safety, leader append-only, log matching, leader completeness, and state machine safety.</li>
<li><strong>Natural Properties</strong>: Leader append-only and log matching properties are naturally provided by PALF since it uses the same log replication scheme as Raft.</li>
<li><strong>Log Reconfirmation</strong>: The key difference from Raft is the log reconfirmation process. A candidate for leadership performs an instance of Basic Paxos to learn missing logs from the replica that has accepted the most logs in a majority. This ensures election safety and leader completeness.</li>
<li><strong>State Machine Safety</strong>: The proof of state machine safety is deferred to a later section (Â§4.1) because it relates to how logs are applied to the transaction engine.</li>
</ul>
<h2 id="41-ç« èŠ‚-æ˜ç¡®çš„æ‰§è¡Œç»“æœ">4.1 ç« èŠ‚ æ˜ç¡®çš„æ‰§è¡Œç»“æœ</h2>
<p>ç¬¬4ç« èŠ‚ ä»‹ç»äº†ä¸ºOceanBaseæ•°æ®åº“çš„äº‹åŠ¡å¼•æ“è®¾è®¡çš„PALFï¼ˆåŸºäºå…±è¯†åè®®å®ç°ï¼‰çš„ç‰¹æ€§ã€‚</p>
<blockquote>
<p>é€šè¿‡é˜…è¯»4.1ç« èŠ‚ æœŸæœ›å›ç­” ç½‘ç»œåˆ†åŒºæƒ…å†µä¸‹ï¼Œè¿˜èƒ½ä¿è¯æ•°æ®ä¸€è‡´æ€§å—ï¼Ÿ</p>
</blockquote>
<ol>
<li><strong>ä»€ä¹ˆæ˜¯pending logsï¼Œä¸å¤„ç†æœ‰ä»€ä¹ˆå½±å“</strong></li>
</ol>
<p>ä¾‹å¦‚ï¼šäº‹åŠ¡å¼•æ“ é€šè¿‡PALFæ¥å£æ·»åŠ ä¸€ä¸ªè®°å½•ï¼ˆrecordï¼‰</p>
<p>å¦‚æœå› ä¸ºç½‘ç»œæ•…éšœ äº§ç”Ÿæ–°çš„é€‰ä¸¾ï¼Œ
æ–°çš„é¢†å¯¼ ä¸çŸ¥é“ å‰ä»»é¢†å¯¼è€…æ–°å¢çš„æ—¥å¿—æ¡ç›®ï¼ˆappended log<br>
entriesï¼‰æ˜¯å¦æäº¤ï¼Œè¿™äº›å°šæœªç¡®è®¤çš„æ—¥å¿—è¢«ç§°ä¸ºâ€œå¾…å®šæ—¥å¿—â€(pending logs)ã€‚</p>
<p>PALFæ¥å£å¿…é¡»è¿”å›æ˜ç¡®çš„æ‰§è¡Œç»“æœï¼Œæ˜¯æˆåŠŸ è¿˜æ˜¯å¤±è´¥ï¼Œäº‹åŠ¡å¼•æ“ æ ¹æ®è¿”å›åˆ¤æ–­è¯¥äº‹åŠ¡æ˜¯commit or rollbackã€‚</p>
<ol start="2">
<li><strong>è°è´Ÿè´£è§£å†³ä¸Šä¸ªé¢†å¯¼æœªå¤„ç†çš„è¯·æ±‚</strong></li>
</ol>
<p>è‡ªç„¶æ˜¯PALFlæ¥è§£å†³ï¼ˆä»€ä¹ˆæƒ…å†µä¸‹æ— æ³•è§£å†³å‘¢ ï¼‰</p>
<blockquote>
<p>PALF guarantees that the transaction engine will be explicitly<br>
notified of replication results unless the leader crashes or the network is interrupted permanently</p>
</blockquote>
<p>å¦‚æœé¢†å¯¼æƒè½¬ç§»åˆ°äº†å¦ä¸€ä¸ªå‰¯æœ¬ï¼Œ</p>
<ul>
<li>
<p>å‰ä»»é¢†å¯¼è€…ä¼šå˜æˆâ€œå¾…å®šè·Ÿéšè€…â€ï¼ˆpending followerï¼‰</p>
</li>
<li>
<p>å½“è¿™ä¸ªâ€œå¾…å®šè·Ÿéšè€…â€ä»æ–°çš„é¢†å¯¼è€…é‚£é‡Œæ¥æ”¶åˆ°æ—¥å¿—æ—¶ï¼Œè¿™äº›å¾…å®šæ—¥å¿—çš„å¤åˆ¶ç»“æœå°±ä¼šå˜å¾—æ˜ç¡®â€”â€”è¦ä¹ˆè¢«ç¡®è®¤æäº¤ï¼Œè¦ä¹ˆè¢«æˆªæ–­ã€‚</p>
</li>
</ul>
<p>When the pending follower receives logs from the<br>
new leader, the replication results of pending logs become explicit<br>
(committed or truncated)</p>
<ul>
<li>
<p>å¯¹äºå·²æäº¤çš„æ—¥å¿—ï¼Œç³»ç»Ÿä¼šé€šè¿‡è°ƒç”¨æˆåŠŸå‡½æ•°æ¥é€šçŸ¥äº‹åŠ¡å¼•æ“ï¼›</p>
</li>
<li>
<p>è€Œå¯¹äºè¢«æˆªæ–­çš„æ—¥å¿—ï¼Œåˆ™ä¼šé€šè¿‡è°ƒç”¨å¤±è´¥å‡½æ•°æ¥é€šçŸ¥å¤åˆ¶å¤±è´¥ã€‚</p>
</li>
</ul>
<p>å› æ­¤ï¼Œå‰ä»»é¢†å¯¼è€…å¿…é¡»è½¬æ¢ä¸ºâ€œå¾…å®šè·Ÿéšè€…â€ï¼Œç­‰å¾…æ–°é¢†å¯¼è€…çš„æ—¥å¿—ï¼Œ
ç„¶åæ‰èƒ½æ­£å¼æˆä¸ºè·Ÿéšè€…</p>
<ol start="3">
<li><strong>æ€ä¹ˆè§£å†³ï¼Œè¿™ä¸ªè¯æ˜è¿‡ç¨‹æ²¡çœ‹æ‡‚è·³è¿‡</strong></li>
</ol>
<p>åŸæ–‡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Data synchronization tools (such as Change Data Capture) usually consume transactions in the order of logs; however, the LSN  
is incompetent for tracking the order of transactions because it  
is locally ordered within single PALF group. For scalability, data  
partitions are usually distributed among multiple Streams. If different transactions modify data partitions in different Streams, the  
LSNs of their logs are incomparable. To track the order of transactions with logs across PALF groups, a natural approach is to record  
commit versions of transactions in the payloads of log entries, as  
some systems have done [18, 42]. This approach does work, but it  
has disadvantages. For instance, commit versions may not strictly  
increase with LSN due to parallel executions of transactions (i.e.,  
assigning smaller LSN to logs of transactions with greater commit
</code></pre></td></tr></table>
</div>
</div><p>åŸæ–‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">The OceanBase database provides globally meaningful commit  
versions to transactions using CSN. 

When a transaction is going to  
be committed, the transaction engine fetches a timestamp from a  
global timestamp oracle and appends the commit record with the  
timestamp as ğ‘…ğ‘’ğ‘“ ğ¶ğ‘†ğ‘ . The ğ¶ğ‘†ğ‘ returned by the append method  
tracks the order indicated by ğ‘…ğ‘’ğ‘“ ğ¶ğ‘†ğ‘ and acts as the commit version of the transaction. 

Note that the ğ¶ğ‘†ğ‘ is not generated by  
the global timestamp oracle, which may have a value greater than  
the current global timestamp.

As a result, the transaction may  
be invisible to a future read request that fetches a smaller readable version from the global timestamp oracle. 

To avoid this, the  
transaction engine will not respond to the client until the global  
timestamp is greater than the ğ¶ğ‘†ğ‘ . Through cooperation between  
the transaction engine and PALF, CSN successfully tracks the order  
of transactions across PALF groups
</code></pre></td></tr></table>
</div>
</div><h2 id="è¯¾åä½œä¸š">è¯¾åä½œä¸š</h2>
<ol>
<li>Raft ä¸PALFåœ¨å¤„ç†ä¸Šä¸€ä¸ªä»»æœŸçš„æ—¥å¿—æœ‰ä»€ä¹ˆå·®å¼‚
4.1 Explicit Replication Results  ç»™å‡ºpending logs è¯æ˜è¿‡ç¨‹ä½†æ˜¯æ²¡çœ‹æ‡‚</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">ä½ æ˜¯ä¸€ä½è®¡ç®—æœºä¸“ä¸šç¿»è¯‘ä¸“å®¶ï¼ŒæŒæ¡ä¸°å¯Œçš„è®¡ç®—çŸ¥è¯†å¹¶ä¸”è½¬åŒ–å°ç™½ç†è§£çš„è¯­è¨€ï¼Œæˆ‘å¸Œæœ›ä½ èƒ½å¸®æˆ‘å°†ä»¥ä¸‹è‹±æ–‡è§†é¢‘çš„ä¸­æ–‡ç¿»è¯‘ç»“æœé‡æ–°æ„è¯‘å’Œæ¶¦è‰²ã€‚

è§„åˆ™ï¼š
- è¿™äº›å­—å¹•åŒ…å«è®¡ç®—æœºç­‰ä¸“ä¸šçŸ¥è¯†ç›¸å…³ï¼Œæ³¨æ„ç¿»è¯‘æ—¶æœ¯è¯­çš„å‡†ç¡®æ€§
- ä¿ç•™ç‰¹å®šçš„è‹±æ–‡æœ¯è¯­ã€æ•°å­—æˆ–åå­—ï¼Œå¹¶åœ¨å…¶å‰ååŠ ä¸Šç©ºæ ¼
- åŸºäºç›´è¯‘ç»“æœé‡æ–°æ„è¯‘ï¼Œæ„è¯‘æ—¶åŠ¡å¿…å¯¹ç…§åŸå§‹è‹±æ–‡ï¼Œä¸è¦æ·»åŠ ä¹Ÿä¸è¦é—æ¼å†…å®¹ï¼Œå¹¶ä»¥è®©ç¿»è¯‘ç»“æœé€šä¿—æ˜“æ‡‚ï¼Œç¬¦åˆä¸­æ–‡è¡¨è¾¾ä¹ æƒ¯

è‹±æ–‡åŸæ–‡ï¼š
{ è‹±æ–‡åŸæ–‡ }

ç›´è¯‘ç»“æœï¼š
{ ç¬¬ä¸€ç›´è¯‘çš„ç»“æœ }

é‡æ–°æ„è¯‘å’Œæ¶¦è‰² å’Œæ’ç‰ˆç¾åŒ–
{ æ¶¦è‰²çš„ç»“æœ }

è¯­æ³•åˆ†æï¼š
{ }

ç»“åˆä¸“ä¸šçŸ¥è¯† ç»™å‡ºè‡ªå·±ç†è§£ ä½¿ç”¨ç”¨Mermaidè¯­æ³•ç»˜åˆ¶æµç¨‹å›¾ï¼Œå¹¶ä¸”æ˜¯æ‰‹ç»˜é£æ ¼
æ•´ä½“ç†è§£:
ä¸ºäº†æŒæ¡å¯ä»¥ç»™å‡ºä¸‰ä¸ªé¢˜ç›®è¿›è¡Œç»ƒä¹ ï¼Ÿ

</code></pre></td></tr></table>
</div>
</div><h2 id="todo2paxos-è¯•é¢˜çœ‹çœ‹ä½ èƒ½å¾—å¤šå°‘åˆ†">TODO2:Paxos è¯•é¢˜ï¼Œçœ‹çœ‹ä½ èƒ½å¾—å¤šå°‘åˆ†</h2>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<p><a href="https://leehao.me/%E5%9B%BE%E8%A7%A3-Paxos-%E7%AE%97%E6%B3%95/">https://leehao.me/%E5%9B%BE%E8%A7%A3-Paxos-%E7%AE%97%E6%B3%95/</a></p>
<p>ä»åšä¸€ä¸ªéš¾è€Œæ­£ç¡®äº‹æƒ…å¼€å§‹
ç¬¬ä¸€æ­¥ å®šæŠ•10åˆ†é’Ÿï¼ŒæŠŠäº‹æƒ…ç®€åŒ–ï¼Œ
ä¸€å¤©å†™ä¸€è¡Œæ–‡å­—ï¼Œä¸€å‘¨ä¸€æ®µï¼Œä¸€æœˆä¸€ç¯‡æ–‡ç« ï¼Œ
é€‰æ ‡é¢˜ï¼Œå†™å¤§çº²ï¼Œå¡«å……å†…å®¹
ç¬¬äºŒæ­¥ï¼šæ’é™¤æ— å…³ä¸ç›¸å…³äº‹æƒ…ï¼Œçœ‹çŸ­è§†é¢‘ï¼Œçœ‹ç»¼è‰ºï¼Œçœ‹æ–°é—»ï¼Œçœ‹åšä¸» ä¸€ä¸ªæ–¹æ³•ã€‚å¤šå°‘ç²‰ä¸å¤šå°‘æµé‡
ç»™ä½ ä½ æ— å…³ã€‚</p>
<h1 id="oceanbase-æºç è§£è¯»">OceanBase æºç è§£è¯»</h1>
<p>OceanBase æ­£å¼å¼€æºåï¼Œ300 ä¸‡è¡Œæ ¸å¿ƒä»£ç åœ¨ç¤¾åŒºå®˜ç½‘åŒæ­¥ä¸Šçº¿ï¼Œä½†è¿™äº›ä»£ç æœ‰ä¸€äº›å¤šå¹´å˜è¿çš„é—è¿¹ï¼Œæ–°äººä¸Šæ‰‹æ®Šä¸ºä¸æ˜“ã€‚é€šè¿‡æœ¬ç³»åˆ—çš„æºç è§£è¯»æ–‡ç« ï¼Œé¦–å…ˆï¼Œä½ å¯ä»¥äº†è§£ OceanBase æ•°æ®åº“çš„åŸºæœ¬åŸç†ï¼Œå­¦åˆ°ä¸€ä¸ªæ•°æ®åº“æ˜¯å¦‚ä½•å®ç°çš„ã€‚æ¨è€Œå¹¿ä¹‹ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠ OceanBase çš„å®ç°åŸç†åº”ç”¨åˆ°å…¶ä»–æ•°æ®åº“ï¼Œè¿™å¯¹ä½ å­¦ä¹ å…¶ä»–æ•°æ®åº“ä¹Ÿæœ‰å¸®åŠ©ã€‚å…¶æ¬¡ï¼Œåœ¨ç†Ÿæ‚‰äº† OceanBase çš„ä»£ç ä¹‹åï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨æœªæ¥çš„å·¥ä½œä¸­ä½¿ç”¨æˆ‘ä»¬çš„ä»£ç ï¼Œæˆ–è€…ä¸º OceanBase è´¡çŒ®ä»£ç ã€‚</p>
<p><a href="https://open.oceanbase.com/blog/topics/3983502080">https://open.oceanbase.com/blog/topics/3983502080</a></p>
<h3 id="1-oceanbase-paxosstore-æºç é˜…è¯»">[1] Oceanbase PaxosStore æºç é˜…è¯»</h3>
<p><a href="https://zhuanlan.zhihu.com/p/395197545">https://zhuanlan.zhihu.com/p/395197545</a></p>
<p>å¼€æºæ•°æ®åº“OceanBaseä»£ç å¯¼è¯»ï¼ˆ13ï¼‰</p>
<ul>
<li><a href="https://github.com/oceanbase/oceanbase-doc">https://github.com/oceanbase/oceanbase-doc</a></li>
<li><a href="https://www.oceanbase.com/training/obcp">OBCP V3.0 åŸ¹è®­æ•™æ</a></li>
<li><a href="https://console.oceanbase.com/instances">https://console.oceanbase.com/instances</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzU3OTc2MDQxNg==&amp;mid=2247483885&amp;idx=1&amp;sn=52bf5a7c8cbea04671f2327455fd16da&amp;chksm=fd6079a2ca17f0b456055a20d3b17ba2125704a2fb4a81d08d375c1ea69f2d4ce93c5f8fe04f&amp;scene=21#wechat_redirect"> OceanBaseæ•°æ®åº“å®è·µå…¥é—¨â€”â€”äº†è§£æ€»æ§æœåŠ¡</a></li>
</ul>
<p>å¾®ä¿¡ï¼š</p>
<ul>
<li><a href="https://mp.weixin.qq.com/s/L0uBV8s5gXagiylz4vYyOg">https://mp.weixin.qq.com/s/L0uBV8s5gXagiylz4vYyOg</a> # OceanBase ç‹¬ç«‹éƒ¨ç½²é«˜çº§ç©æ³•ä¸‰ï¼šå‰¯æœ¬æ•°è°ƒæ•´</li>
<li>OceanBase ç‹¬ç«‹éƒ¨ç½²é«˜çº§ç©æ³•äºŒ ï¼š2C8Gç‰ˆ</li>
<li>OceanBase æºç è§£è¯»ï¼ˆåå››ï¼‰ï¼šé›†ç¾¤ä½ç½®ä¿¡æ¯çš„å­˜å‚¨ä¸æ±‡æŠ¥
<a href="https://open.oceanbase.com/blog/10900275">https://open.oceanbase.com/blog/10900275</a></li>
<li>OceanBase æ•°æ®åº“ V4.0 ç‰ˆæœ¬ä¸­æœ‰å…³ bootstrap é—®é¢˜çš„æ’æŸ¥
<a href="https://www.oceanbase.com/knowledge-base/oceanbase-database-1000000000781056">https://www.oceanbase.com/knowledge-base/oceanbase-database-1000000000781056</a></li>
</ul>
<p>è®°å½•æ˜¯ä¸ºäº†æ›´å¥½çš„æ€è€ƒ</p>
<p>http://localhost:1313/post/oceanbase/2024/07_make_ob_leader/</p>
<h3 id="æ²Ÿé€šæ­¥éª¤">æ²Ÿé€šæ­¥éª¤</h3>
<ol>
<li>
<p>å‡†å¤‡ä¸€ä¸ªå›¾ç‰‡ï¼Œä¸€æ®µè¯ï¼Œå¯ä»¥æ”¾åœ¨ä¸‰é¡µdocï¼Œä¸‰é¡µppt æè¿°ä½ æ–¹æ¡ˆ</p>
<p>ä¸€ã€è¿™ä¸ªæŠ€æœ¯å‡ºç°çš„èƒŒæ™¯ã€åˆè¡·å’Œè¦è¾¾åˆ°ä»€ä¹ˆæ ·çš„ç›®æ ‡æˆ–æ˜¯è¦è§£å†³ä»€ä¹ˆæ ·çš„é—®é¢˜</p>
<p>äºŒã€è¿™ä¸ªæŠ€æœ¯çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿åˆ†åˆ«æ˜¯ä»€ä¹ˆ</p>
<p>ä¸‰ã€è¿™ä¸ªæŠ€æœ¯é€‚ç”¨çš„åœºæ™¯ã€‚ä»»ä½•æŠ€æœ¯éƒ½æœ‰å…¶é€‚ç”¨çš„åœºæ™¯ï¼Œç¦»å¼€äº†è¿™ä¸ªåœºæ™¯</p>
<p>å››ã€æŠ€æœ¯çš„ç»„æˆéƒ¨åˆ†å’Œå…³é”®ç‚¹ã€‚</p>
<p>äº”ã€æŠ€æœ¯çš„åº•å±‚åŸç†å’Œå…³é”®å®ç°</p>
<p>å…­ã€å·²æœ‰çš„å®ç°å’Œå®ƒä¹‹é—´çš„å¯¹æ¯”</p>
</li>
<li>
<p>åé¦ˆï¼šé¸¡è›‹é‡ŒæŒ‘éª¨å¤´ï¼Œç»è¿‡å®¢æˆ·ï¼Œé¢†å¯¼ ï¼Œå…¬å¸è®¤è¯ï¼Œåšäº‹æƒ…ä»·å€¼å’Œæ„ä¹‰ã€‚å¬åˆ°å¦å®šæ„¤æ€’åå¯¹ è¯´æ˜è‡ªå·±å¯¹è¿™ä¸ªäº‹æƒ…è¿˜ä¸äº†è§£ã€‚</p>
</li>
<li>
<p>æœ€åèåˆåˆ«äººå»ºè®®ï¼Œç„¶åå®Œå–„ä½ é¡¹ç›®</p>
</li>
</ol>
<p><a href="https://zhuanlan.zhihu.com/p/268558189">https://zhuanlan.zhihu.com/p/268558189</a></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content">Troy</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">
        2024-12-21 00:00
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">è®¸å¯åè®®</span>
    <span class="item-content"><a target="_blank" rel="license noopener" href="https://github.com/nusr/blog/blob/master/LICENSE">MIT</a></span>
  </p>
</div>
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/ARTS/2024/%E5%8F%AA%E7%AE%A1%E5%8E%BB%E5%81%9A%E8%B7%B5N0.14-2025-1-2/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">åªç®¡å»åšè·µN0.14</span>
            <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
          </a>
        <a class="next" href="/post/oceanbase/2024/day10/">
            <span class="next-text nav-default">æˆä¸ºobè´¡çŒ®è€…(09):å¦‚ä½•è¯æ˜é‡‡ç”¨äº†PALFè®¾è®¡å°±æ˜¯å®‰å…¨çš„</span>
            <span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
            repo="wangcy6/wangcy6.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:wang_cyi@163.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/wangcy6" class="iconfont icon-github" title="github"></a>
  <a href="https://wangcy6.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://gohugo.io">Hugo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> æœ¬ç«™æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> æ¬¡ </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> æœ¬ç«™æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> äºº </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2017 - 
    2025
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Troy</span>
  </span>
</div>
<script src="https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget/autoload.js"></script>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js" integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js" integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin="anonymous"></script>
  <script><!-- NOTE: timeago.js uses the language code format like "zh_CN" (underscore and case sensitive) -->
    var languageCode = "zh-cn".replace(/-/g, '_').replace(/_(.*)/, function ($0, $1) {return $0.replace($1, $1.toUpperCase());});
    timeago().render(document.querySelectorAll('.timeago'), languageCode);
    timeago.cancel();  
  </script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-138883536-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
